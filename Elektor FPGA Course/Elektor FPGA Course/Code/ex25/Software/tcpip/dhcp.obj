objectfile:dhcp.obj
time:Thu Dec 14 11:33:34 2006
cpuname:i8051
import:__st_dptr_r67
import:__st_dptr_r47
import:__cmp_u4
import:_subnet_ip
import:__ld_dptr_r67
import:__ld_dptr_r47
import:_open_socket_udp
import:_my_ip
import:_close_socket_udp
import:_puts
import:_free_tx_buf
import:_rcv_len
import:_poll_net
import:_rcv_buf
import:_uc_socket
import:_xram_fast_copy
import:_gateway_ip
import:_send_socket_udp
import:_my_mac
import:__mul_i2
import:_memset
import:_allocate_tx_buf
export:_parseDHCPMSG @1a:0
export:_send_DHCP_REQUEST @8:0
export:_SetupTimer @e:0
export:_send_DHCP_DISCOVER @5:0
export:_DHCP_SetIP @18:0
export:_DefaultNetConfig @b:0
segment:_send_DHCP_DISCOVER_formal_near @0:m s:0 u:0 n f c:dram
segment:_send_DHCP_DISCOVER_local_near @1:m s:3 u:0 n f c:dram
segment:_memset_formal_near @2:m s:0 u:0 n f c:dram
segment:_xram_fast_copy_formal_near @3:m s:0 u:0 n f c:dram
segment:_send_socket_udp_formal_near @4:m s:0 u:0 n f c:dram
segment:__send_DHCP_DISCOVER @5:m u:232
8c 00 8d 00 8f 00 85 00 83 85 00 82 74 01 f0 ae
00 af 00 0f ef 70 00 0e 85 06 83 85 07 82 74 01
f0 ae 00 af 00 74 02 2f ff e4 3e fe 85 06 83 85
07 82 74 06 f0 ae 00 af 00 74 03 2f ff e4 3e fe
85 06 83 85 07 82 e4 f0 ae 00 af 00 74 04 2f fb
e4 3e fa 7c 12 7d 34 7e 56 7f 70 8a 83 8b 82 12
00 00 ae 00 af 00 74 08 2f fd e4 3e fc e4 fe ff
8c 83 8d 82 12 00 00 ae 00 af 00 74 0a 2f fd e4
3e fc e4 fe ff 8c 83 8d 82 12 00 00 7a 02 7b 18
e4 fd ae 00 af 00 74 0c 2f ff e4 3e fe 12 00 00
7a 00 7b 06 ae 00 af 00 74 1c 2f fd e4 3e fc 7e
00 7f 00 12 00 00 ae 00 af 00 74 ec 2f fb e4 3e
fa 7c 63 7d 82 7e 53 7f 63 8a 83 8b 82 12 00 00
ae 00 af 00 74 f0 2f ff e4 3e fe 85 06 83 85 07
82 74 35 f0 ae 00 af 00 74 f1 2f ff e4 3e fe 85
06 83 85 07 82 74 01 f0 ae 00 af 00 74 f2 2f ff
e4 3e fe 85 06 83 85 07 82 74 01 f0 ae 00 af 00
74 f3 2f ff e4 3e fe 85 06 83 85 07 82 74 37 f0
ae 00 af 00 74 f4 2f ff e4 3e fe 85 06 83 85 07
82 74 05 f0 ae 00 af 00 74 f5 2f ff e4 3e fe 85
06 83 85 07 82 74 01 f0 ae 00 af 00 74 f6 2f ff
e4 3e fe 85 06 83 85 07 82 74 03 f0 ae 00 af 00
74 f7 2f ff e4 3e fe 85 06 83 85 07 82 74 06 f0
ae 00 af 00 74 f8 2f ff e4 3e fe 85 06 83 85 07
82 74 3a f0 ae 00 af 00 74 f9 2f ff e4 3e fe 85
06 83 85 07 82 74 3b f0 ae 00 af 00 74 fa 2f ff
e4 3e fe 85 06 83 85 07 82 74 0c f0 ae 00 af 00
74 fb 2f ff e4 3e fe 85 06 83 85 07 82 74 04 f0
ae 00 af 00 74 fc 2f ff e4 3e fe 85 06 83 85 07
82 74 46 f0 ae 00 af 00 74 fd 2f ff e4 3e fe 85
06 83 85 07 82 74 50 f0 ae 00 af 00 74 fe 2f ff
e4 3e fe 85 06 83 85 07 82 74 47 f0 ae 00 af 00
74 ff 2f ff e4 3e fe 85 06 83 85 07 82 74 41 f0
ae 00 af 00 e4 2f ff 74 01 3e fe 85 06 83 85 07
82 74 ff f0 7a 02 7b 24 ac 00 ad 00 af 00 12 00
00 22
segment:_send_DHCP_REQUEST_formal_near @6:m s:0 u:0 n f c:dram
segment:_send_DHCP_REQUEST_local_near @7:m s:3 u:0 n f c:dram
segment:__send_DHCP_REQUEST @8:m u:24b
8c 00 8d 00 8f 00 85 00 83 85 00 82 74 01 f0 ae
00 af 00 0f ef 70 00 0e 85 06 83 85 07 82 74 01
f0 ae 00 af 00 74 02 2f ff e4 3e fe 85 06 83 85
07 82 74 06 f0 ae 00 af 00 74 03 2f ff e4 3e fe
85 06 83 85 07 82 e4 f0 ae 00 af 00 74 04 2f fb
e4 3e fa 7c 12 7d 34 7e 56 7f 70 8a 83 8b 82 12
00 00 ae 00 af 00 74 08 2f fd e4 3e fc e4 fe ff
8c 83 8d 82 12 00 00 ae 00 af 00 74 0a 2f fd e4
3e fc 7e 80 7f 00 8c 83 8d 82 12 00 00 ae 00 af
00 74 0c 2f fb e4 3e fa 90 00 00 12 00 00 8a 83
8b 82 12 00 00 7a 02 7b 14 e4 fd ae 00 af 00 74
10 2f ff e4 3e fe 12 00 00 7a 00 7b 06 ae 00 af
00 74 1c 2f fd e4 3e fc 7e 00 7f 00 12 00 00 ae
00 af 00 74 ec 2f fb e4 3e fa 7c 63 7d 82 7e 53
7f 63 8a 83 8b 82 12 00 00 ae 00 af 00 74 f0 2f
ff e4 3e fe 85 06 83 85 07 82 74 35 f0 ae 00 af
00 74 f1 2f ff e4 3e fe 85 06 83 85 07 82 74 01
f0 ae 00 af 00 74 f2 2f ff e4 3e fe 85 06 83 85
07 82 74 03 f0 ae 00 af 00 74 f3 2f ff e4 3e fe
85 06 83 85 07 82 74 37 f0 ae 00 af 00 74 f4 2f
ff e4 3e fe 85 06 83 85 07 82 74 05 f0 ae 00 af
00 74 f5 2f ff e4 3e fe 85 06 83 85 07 82 74 01
f0 ae 00 af 00 74 f6 2f ff e4 3e fe 85 06 83 85
07 82 74 03 f0 ae 00 af 00 74 f7 2f ff e4 3e fe
85 06 83 85 07 82 74 06 f0 ae 00 af 00 74 f8 2f
ff e4 3e fe 85 06 83 85 07 82 74 3a f0 ae 00 af
00 74 f9 2f ff e4 3e fe 85 06 83 85 07 82 74 3b
f0 ae 00 af 00 74 fa 2f ff e4 3e fe 85 06 83 85
07 82 74 0c f0 ae 00 af 00 74 fb 2f ff e4 3e fe
85 06 83 85 07 82 74 04 f0 ae 00 af 00 74 fc 2f
ff e4 3e fe 85 06 83 85 07 82 74 46 f0 ae 00 af
00 74 fd 2f ff e4 3e fe 85 06 83 85 07 82 74 50
f0 ae 00 af 00 74 fe 2f ff e4 3e fe 85 06 83 85
07 82 74 47 f0 ae 00 af 00 74 ff 2f ff e4 3e fe
85 06 83 85 07 82 74 41 f0 ae 00 af 00 e4 2f ff
74 01 3e fe 85 06 83 85 07 82 74 ff f0 7a 02 7b
24 ac 00 ad 00 af 00 12 00 00 22
segment:_DefaultNetConfig_formal_near @9:m s:0 u:0 n f c:dram
segment:_DefaultNetConfig_local_near @a:m s:0 u:0 n f c:dram
segment:__DefaultNetConfig @b:m u:18
90 00 00 74 c0 f0 90 00 00 74 a8 f0 90 00 00 e4
f0 90 00 00 74 01 f0 22
segment:_SetupTimer_formal_near @c:m s:0 u:0 n f c:dram
segment:_SetupTimer_local_near @d:m s:0 u:0 n f c:dram
segment:__SetupTimer @e:m u:15
c2 8f c2 8e 53 89 0f 43 89 10 e4 f5 8d e4 f5 8b
d2 8e c2 ab 22
segment:_DHCP_SetIP_formal_near @f:m s:0 u:0 n f c:dram
segment:_DHCP_SetIP_local_near @10:m s:6 u:0 n f c:dram
segment:_open_socket_udp_formal_near @11:m s:2 u:0 n f c:dram
segment:_puts_formal_near @12:m s:0 u:0 n f c:dram
segment:_allocate_tx_buf_formal_near @13:m s:0 u:0 n f c:dram
segment:_poll_net_formal_near @14:m s:0 u:0 n f c:dram
segment:_parseDHCPMSG_formal_near @15:m s:0 u:0 n f c:dram
segment:_free_tx_buf_formal_near @16:m s:0 u:0 n f c:dram
segment:_close_socket_udp_formal_near @17:m s:0 u:0 n f c:dram
segment:__DHCP_SetIP @18:m u:149
e4 f5 00 e4 f5 00 90 00 00 74 01 f0 90 00 00 e4
f0 a3 74 44 f0 75 00 00 75 00 43 78 ff 79 ff 7a
ff 7b ff 7f 01 12 00 00 ee 4f 60 00 7e 00 7f 00
7c 01 12 00 00 e4 ff 02 00 00 12 00 00 8e 00 8f
00 02 00 00 e4 f5 00 ac 00 ad 00 7f 01 12 00 00
12 00 00 e4 f5 00 80 00 c2 8f 80 00 12 00 00 ac
06 ad 07 7f 00 ec fe bf 00 00 be e2 00 ed ff 7e
00 12 00 00 8f 00 74 02 65 00 70 00 75 00 01 80
00 30 8f 00 05 00 7d 20 af 00 c3 e5 07 95 05 50
00 e5 00 60 00 74 02 65 00 60 00 ad 00 af 05 0f
8f 00 7f 0a d3 ed 9f 40 00 c2 8e ae 00 af 00 12
00 00 7f 01 12 00 00 12 00 00 e4 ff 02 00 00 02
00 00 e4 f5 00 e4 f5 00 02 00 00 e4 f5 00 ac 00
ad 00 7f 01 12 00 00 12 00 00 e4 f5 00 80 00 c2
8f 80 00 12 00 00 ac 06 ad 07 7f 00 ec fe bf 00
00 be e2 00 ed ff 7e 00 12 00 00 8f 00 74 05 65
00 70 00 75 00 01 80 00 30 8f 00 05 00 7d 20 af
00 c3 e5 07 95 05 50 00 e5 00 60 00 74 05 65 00
60 00 ad 00 af 05 0f 8f 00 7f 0a d3 ed 9f 40 00
12 00 00 80 00 02 00 00 ae 00 af 00 12 00 00 7f
01 12 00 00 c2 8e 7f 01 22
segment:_parseDHCPMSG_local_near @19:m s:7 u:0 n f c:dram
segment:__parseDHCPMSG @1a:m u:142
e4 fe fc 7d 32 12 00 00 7c 00 7d 00 ed 2f ff ec
3e fe 8e 83 8f 82 12 00 00 ef 64 43 4e 70 00 90
00 00 12 00 00 90 00 00 12 00 00 e4 f5 00 7e 00
7f 00 74 f0 2f ff e4 3e fe 8e 00 8f 00 90 00 00
12 00 00 74 10 2f ff 74 ff 3e fe e5 00 2f ff e5
00 3e fe 8e 00 8f 00 02 00 00 85 00 83 85 00 82
74 01 25 82 f5 00 e4 35 83 f5 00 e0 fd 64 35 60
00 7f 35 d3 ed 9f 50 00 ed 70 00 02 00 00 ed 64
01 60 00 ed 64 03 70 00 02 00 00 02 00 00 ed f4
60 00 02 00 00 af 00 02 00 00 ae 00 af 00 0f ef
70 00 0e 8e 83 8f 82 74 01 25 82 f5 00 e4 35 83
f5 00 e0 ff 8f 00 02 00 00 74 01 25 00 f5 00 e4
35 00 f5 00 7a 00 7b 04 7c 00 7d 00 ae 00 af 00
12 00 00 74 04 25 00 f5 00 e4 35 00 f5 00 80 00
74 01 25 00 f5 00 e4 35 00 f5 00 7a 00 7b 04 7c
00 7d 00 ae 00 af 00 12 00 00 74 04 25 00 f5 00
e4 35 00 f5 00 80 00 85 00 83 85 00 82 ae 83 af
82 74 01 2f fd e4 3e fc e0 ff 7e 00 ed 2f ff ec
3e fe 8e 00 8f 00 ae 00 af 00 ab 07 aa 06 78 00
ae 00 af 00 7c 00 c3 12 00 00 50 00 02 00 00 af
00 22
segment:lit @1b:m u:1a
45 72 72 6f 72 20 6f 70 65 6e 69 6e 67 20 55 44
50 20 53 6f 63 6b 65 74 0d 00
sgraph:_send_DHCP_DISCOVER_formal_near _send_DHCP_DISCOVER_local_near __send_DHCP_DISCOVER
sgraph:_send_DHCP_DISCOVER_local_near _send_socket_udp_formal_near __send_DHCP_DISCOVER 0
sgraph:_send_DHCP_DISCOVER_local_near _xram_fast_copy_formal_near __send_DHCP_DISCOVER 3
sgraph:_send_DHCP_DISCOVER_local_near _memset_formal_near __send_DHCP_DISCOVER 3
sgraph:_send_DHCP_REQUEST_formal_near _send_DHCP_REQUEST_local_near __send_DHCP_REQUEST
sgraph:_send_DHCP_REQUEST_local_near _send_socket_udp_formal_near __send_DHCP_REQUEST 0
sgraph:_send_DHCP_REQUEST_local_near _xram_fast_copy_formal_near __send_DHCP_REQUEST 3
sgraph:_send_DHCP_REQUEST_local_near _memset_formal_near __send_DHCP_REQUEST 3
sgraph:_DefaultNetConfig_formal_near _DefaultNetConfig_local_near __DefaultNetConfig
sgraph:_SetupTimer_formal_near _SetupTimer_local_near __SetupTimer
sgraph:_DHCP_SetIP_formal_near _DHCP_SetIP_local_near __DHCP_SetIP
sgraph:_DHCP_SetIP_local_near _close_socket_udp_formal_near __DHCP_SetIP 0
sgraph:_DHCP_SetIP_local_near _free_tx_buf_formal_near __DHCP_SetIP 0
sgraph:_DHCP_SetIP_local_near _DefaultNetConfig_formal_near __DHCP_SetIP 4
sgraph:_DHCP_SetIP_local_near _parseDHCPMSG_formal_near __DHCP_SetIP 6
sgraph:_DHCP_SetIP_local_near _poll_net_formal_near __DHCP_SetIP 6
sgraph:_DHCP_SetIP_local_near _SetupTimer_formal_near __DHCP_SetIP 5
sgraph:_DHCP_SetIP_local_near _send_DHCP_REQUEST_formal_near __DHCP_SetIP 5
sgraph:_DHCP_SetIP_local_near _DefaultNetConfig_formal_near __DHCP_SetIP 4
sgraph:_DHCP_SetIP_local_near _close_socket_udp_formal_near __DHCP_SetIP 4
sgraph:_DHCP_SetIP_local_near _free_tx_buf_formal_near __DHCP_SetIP 4
sgraph:_DHCP_SetIP_local_near _parseDHCPMSG_formal_near __DHCP_SetIP 6
sgraph:_DHCP_SetIP_local_near _poll_net_formal_near __DHCP_SetIP 6
sgraph:_DHCP_SetIP_local_near _SetupTimer_formal_near __DHCP_SetIP 5
sgraph:_DHCP_SetIP_local_near _send_DHCP_DISCOVER_formal_near __DHCP_SetIP 5
sgraph:_DHCP_SetIP_local_near _allocate_tx_buf_formal_near __DHCP_SetIP 2
sgraph:_DHCP_SetIP_local_near _puts_formal_near __DHCP_SetIP 2
sgraph:_DHCP_SetIP_local_near _open_socket_udp_formal_near __DHCP_SetIP 2
sgraph:_parseDHCPMSG_formal_near _parseDHCPMSG_local_near __parseDHCPMSG
sgraph:_parseDHCPMSG_local_near _xram_fast_copy_formal_near __parseDHCPMSG 7
sgraph:_parseDHCPMSG_local_near _xram_fast_copy_formal_near __parseDHCPMSG 7
src:tcpip\dhcp.s51 #0
src:C:\uC51\include\reg51.def #1
src:C:\uC51\include\reg52.def #2
src:C:\uC51\include\reg51.def #3
ref byte #0:39 @5:1 @1:0 0 +
ref byte #0:3a @5:3 @1:0 0 + 1 +
ref byte #0:3b @5:5 @1:0 2 +
ref byte #0:3d @5:7 @1:0 0 +
ref byte #0:3e @5:a @1:0 0 + 1 +
ref byte #0:42 @5:10 @1:0 0 +
ref byte #0:43 @5:12 @1:0 0 + 1 +
ref rbyte #0:46 @5:16 @5:18
ref byte #0:4e @5:22 @1:0 0 +
ref byte #0:4f @5:24 @1:0 0 + 1 +
ref byte #0:5b @5:36 @1:0 0 +
ref byte #0:5c @5:38 @1:0 0 + 1 +
ref byte #0:68 @5:49 @1:0 0 +
ref byte #0:69 @5:4b @1:0 0 + 1 +
ref w_hl #0:76 @5:60 __st_dptr_r47
ref byte #0:78 @5:63 @1:0 0 +
ref byte #0:79 @5:65 @1:0 0 + 1 +
ref w_hl #0:85 @5:75 __st_dptr_r67
ref byte #0:87 @5:78 @1:0 0 +
ref byte #0:88 @5:7a @1:0 0 + 1 +
ref w_hl #0:94 @5:8a __st_dptr_r67
ref byte #0:9a @5:93 @1:0 0 +
ref byte #0:9b @5:95 @1:0 0 + 1 +
ref w_hl #0:a2 @5:9e _memset
ref byte #0:a6 @5:a5 @1:0 0 +
ref byte #0:a7 @5:a7 @1:0 0 + 1 +
ref byte #0:ae @5:b0 _my_mac 8 >> 255 &
ref byte #0:af @5:b2 _my_mac 255 &
ref w_hl #0:b0 @5:b4 _xram_fast_copy
ref byte #0:b2 @5:b7 @1:0 0 +
ref byte #0:b3 @5:b9 @1:0 0 + 1 +
ref w_hl #0:c0 @5:ce __st_dptr_r47
ref byte #0:c2 @5:d1 @1:0 0 +
ref byte #0:c3 @5:d3 @1:0 0 + 1 +
ref byte #0:cf @5:e5 @1:0 0 +
ref byte #0:d0 @5:e7 @1:0 0 + 1 +
ref byte #0:dc @5:f9 @1:0 0 +
ref byte #0:dd @5:fb @1:0 0 + 1 +
ref byte #0:e9 @5:10d @1:0 0 +
ref byte #0:ea @5:10f @1:0 0 + 1 +
ref byte #0:f6 @5:121 @1:0 0 +
ref byte #0:f7 @5:123 @1:0 0 + 1 +
ref byte #0:103 @5:135 @1:0 0 +
ref byte #0:104 @5:137 @1:0 0 + 1 +
ref byte #0:110 @5:149 @1:0 0 +
ref byte #0:111 @5:14b @1:0 0 + 1 +
ref byte #0:11d @5:15d @1:0 0 +
ref byte #0:11e @5:15f @1:0 0 + 1 +
ref byte #0:12a @5:171 @1:0 0 +
ref byte #0:12b @5:173 @1:0 0 + 1 +
ref byte #0:137 @5:185 @1:0 0 +
ref byte #0:138 @5:187 @1:0 0 + 1 +
ref byte #0:144 @5:199 @1:0 0 +
ref byte #0:145 @5:19b @1:0 0 + 1 +
ref byte #0:151 @5:1ad @1:0 0 +
ref byte #0:152 @5:1af @1:0 0 + 1 +
ref byte #0:15e @5:1c1 @1:0 0 +
ref byte #0:15f @5:1c3 @1:0 0 + 1 +
ref byte #0:16b @5:1d5 @1:0 0 +
ref byte #0:16c @5:1d7 @1:0 0 + 1 +
ref byte #0:178 @5:1e9 @1:0 0 +
ref byte #0:179 @5:1eb @1:0 0 + 1 +
ref byte #0:185 @5:1fd @1:0 0 +
ref byte #0:186 @5:1ff @1:0 0 + 1 +
ref byte #0:192 @5:211 @1:0 0 +
ref byte #0:193 @5:213 @1:0 0 + 1 +
ref byte #0:1a1 @5:229 @1:0 0 +
ref byte #0:1a2 @5:22b @1:0 0 + 1 +
ref byte #0:1a3 @5:22d @1:0 2 +
ref w_hl #0:1a4 @5:22f _send_socket_udp
ref byte #0:1bc @8:1 @7:0 0 +
ref byte #0:1bd @8:3 @7:0 0 + 1 +
ref byte #0:1be @8:5 @7:0 2 +
ref byte #0:1c0 @8:7 @7:0 0 +
ref byte #0:1c1 @8:a @7:0 0 + 1 +
ref byte #0:1c5 @8:10 @7:0 0 +
ref byte #0:1c6 @8:12 @7:0 0 + 1 +
ref rbyte #0:1c9 @8:16 @8:18
ref byte #0:1d1 @8:22 @7:0 0 +
ref byte #0:1d2 @8:24 @7:0 0 + 1 +
ref byte #0:1de @8:36 @7:0 0 +
ref byte #0:1df @8:38 @7:0 0 + 1 +
ref byte #0:1eb @8:49 @7:0 0 +
ref byte #0:1ec @8:4b @7:0 0 + 1 +
ref w_hl #0:1f9 @8:60 __st_dptr_r47
ref byte #0:1fb @8:63 @7:0 0 +
ref byte #0:1fc @8:65 @7:0 0 + 1 +
ref w_hl #0:208 @8:75 __st_dptr_r67
ref byte #0:20a @8:78 @7:0 0 +
ref byte #0:20b @8:7a @7:0 0 + 1 +
ref w_hl #0:216 @8:8b __st_dptr_r67
ref byte #0:218 @8:8e @7:0 0 +
ref byte #0:219 @8:90 @7:0 0 + 1 +
ref w_hl #0:220 @8:99 _my_ip
ref w_hl #0:221 @8:9c __ld_dptr_r47
ref w_hl #0:224 @8:a3 __st_dptr_r47
ref byte #0:22a @8:ac @7:0 0 +
ref byte #0:22b @8:ae @7:0 0 + 1 +
ref w_hl #0:232 @8:b7 _memset
ref byte #0:236 @8:be @7:0 0 +
ref byte #0:237 @8:c0 @7:0 0 + 1 +
ref byte #0:23e @8:c9 _my_mac 8 >> 255 &
ref byte #0:23f @8:cb _my_mac 255 &
ref w_hl #0:240 @8:cd _xram_fast_copy
ref byte #0:242 @8:d0 @7:0 0 +
ref byte #0:243 @8:d2 @7:0 0 + 1 +
ref w_hl #0:250 @8:e7 __st_dptr_r47
ref byte #0:252 @8:ea @7:0 0 +
ref byte #0:253 @8:ec @7:0 0 + 1 +
ref byte #0:25f @8:fe @7:0 0 +
ref byte #0:260 @8:100 @7:0 0 + 1 +
ref byte #0:26c @8:112 @7:0 0 +
ref byte #0:26d @8:114 @7:0 0 + 1 +
ref byte #0:279 @8:126 @7:0 0 +
ref byte #0:27a @8:128 @7:0 0 + 1 +
ref byte #0:286 @8:13a @7:0 0 +
ref byte #0:287 @8:13c @7:0 0 + 1 +
ref byte #0:293 @8:14e @7:0 0 +
ref byte #0:294 @8:150 @7:0 0 + 1 +
ref byte #0:2a0 @8:162 @7:0 0 +
ref byte #0:2a1 @8:164 @7:0 0 + 1 +
ref byte #0:2ad @8:176 @7:0 0 +
ref byte #0:2ae @8:178 @7:0 0 + 1 +
ref byte #0:2ba @8:18a @7:0 0 +
ref byte #0:2bb @8:18c @7:0 0 + 1 +
ref byte #0:2c7 @8:19e @7:0 0 +
ref byte #0:2c8 @8:1a0 @7:0 0 + 1 +
ref byte #0:2d4 @8:1b2 @7:0 0 +
ref byte #0:2d5 @8:1b4 @7:0 0 + 1 +
ref byte #0:2e1 @8:1c6 @7:0 0 +
ref byte #0:2e2 @8:1c8 @7:0 0 + 1 +
ref byte #0:2ee @8:1da @7:0 0 +
ref byte #0:2ef @8:1dc @7:0 0 + 1 +
ref byte #0:2fb @8:1ee @7:0 0 +
ref byte #0:2fc @8:1f0 @7:0 0 + 1 +
ref byte #0:308 @8:202 @7:0 0 +
ref byte #0:309 @8:204 @7:0 0 + 1 +
ref byte #0:315 @8:216 @7:0 0 +
ref byte #0:316 @8:218 @7:0 0 + 1 +
ref byte #0:322 @8:22a @7:0 0 +
ref byte #0:323 @8:22c @7:0 0 + 1 +
ref byte #0:331 @8:242 @7:0 0 +
ref byte #0:332 @8:244 @7:0 0 + 1 +
ref byte #0:333 @8:246 @7:0 2 +
ref w_hl #0:334 @8:248 _send_socket_udp
ref w_hl #0:341 @b:1 _my_ip
ref w_hl #0:345 @b:7 _my_ip 1 +
ref w_hl #0:349 @b:d _my_ip 2 +
ref w_hl #0:34d @b:12 _my_ip 3 +
ref byte #0:3a7 @18:2 @10:0 0 +
ref byte #0:3ab @18:5 @10:0 1 +
ref w_hl #0:3ad @18:7 _uc_socket 50 +
ref w_hl #0:3b1 @18:d _uc_socket 50 + 14 +
ref byte #0:3b8 @18:16 @11:0
ref byte #0:3b9 @18:19 @11:0 1 +
ref w_hl #0:3bf @18:26 _open_socket_udp
ref rbyte #0:3c2 @18:2b @18:3a
ref byte #0:3c4 @18:2d @1b:0 8 >> 255 &
ref byte #0:3c5 @18:2f @1b:0 255 &
ref w_hl #0:3c7 @18:33 _puts
ref w_hl #0:3cb @18:38 @18:148
ref w_hl #0:3ce @18:3b _allocate_tx_buf
ref byte #0:3d0 @18:3e @10:0 2 +
ref byte #0:3d1 @18:40 @10:0 2 + 1 +
ref w_hl #0:3d2 @18:42 @18:bf
ref byte #0:3d7 @18:46 @10:0 4 +
ref byte #0:3d9 @18:48 @10:0 2 +
ref byte #0:3da @18:4a @10:0 2 + 1 +
ref w_hl #0:3dc @18:4e _send_DHCP_DISCOVER
ref w_hl #0:3de @18:51 _SetupTimer
ref byte #0:3e2 @18:55 @10:0 5 +
ref rbyte #0:3e3 @18:57 @18:86
ref rbyte #0:3e7 @18:5b @18:81
ref w_hl #0:3ea @18:5d _poll_net
ref rbyte #0:3f2 @18:69 @18:81
ref rbyte #0:3f3 @18:6c @18:81
ref w_hl #0:3f8 @18:72 _parseDHCPMSG
ref byte #0:3f9 @18:75 @10:0 0 +
ref byte #0:3fc @18:79 @10:0 0 +
ref rbyte #0:3fd @18:7b @18:81
ref byte #0:3ff @18:7d @10:0 4 +
ref rbyte #0:401 @18:80 @18:84
ref rbyte #0:408 @18:83 @18:5c
ref byte #0:40b @18:85 @10:0 5 +
ref byte #0:40f @18:89 @10:0 5 +
ref rbyte #0:413 @18:90 @18:95
ref byte #0:414 @18:92 @10:0 4 +
ref rbyte #0:415 @18:94 @18:58
ref byte #0:419 @18:98 @10:0 0 +
ref rbyte #0:41b @18:9a @18:c2
ref byte #0:41d @18:9c @10:0 1 +
ref byte #0:420 @18:a1 @10:0 1 +
ref rbyte #0:425 @18:a8 @18:bf
ref byte #0:429 @18:ac @10:0 2 +
ref byte #0:42a @18:ae @10:0 2 + 1 +
ref w_hl #0:42b @18:b0 _free_tx_buf
ref w_hl #0:42e @18:b5 _close_socket_udp
ref w_hl #0:430 @18:b8 _DefaultNetConfig
ref w_hl #0:434 @18:bd @18:148
ref w_hl #0:439 @18:c0 @18:44
ref byte #0:43e @18:c4 @10:0 0 +
ref byte #0:442 @18:c7 @10:0 1 +
ref w_hl #0:443 @18:c9 @18:135
ref byte #0:448 @18:cd @10:0 4 +
ref byte #0:44a @18:cf @10:0 2 +
ref byte #0:44b @18:d1 @10:0 2 + 1 +
ref w_hl #0:44d @18:d5 _send_DHCP_REQUEST
ref w_hl #0:44f @18:d8 _SetupTimer
ref byte #0:453 @18:dc @10:0 5 +
ref rbyte #0:454 @18:de @18:10d
ref rbyte #0:458 @18:e2 @18:108
ref w_hl #0:45b @18:e4 _poll_net
ref rbyte #0:463 @18:f0 @18:108
ref rbyte #0:464 @18:f3 @18:108
ref w_hl #0:469 @18:f9 _parseDHCPMSG
ref byte #0:46a @18:fc @10:0 1 +
ref byte #0:46d @18:100 @10:0 1 +
ref rbyte #0:46e @18:102 @18:108
ref byte #0:470 @18:104 @10:0 4 +
ref rbyte #0:472 @18:107 @18:10b
ref rbyte #0:479 @18:10a @18:e3
ref byte #0:47c @18:10c @10:0 5 +
ref byte #0:480 @18:110 @10:0 5 +
ref rbyte #0:484 @18:117 @18:11c
ref byte #0:485 @18:119 @10:0 4 +
ref rbyte #0:486 @18:11b @18:df
ref byte #0:48a @18:11f @10:0 1 +
ref rbyte #0:48c @18:121 @18:138
ref byte #0:48e @18:123 @10:0 0 +
ref byte #0:491 @18:128 @10:0 0 +
ref rbyte #0:496 @18:12f @18:135
ref w_hl #0:498 @18:131 _DefaultNetConfig
ref rbyte #0:49a @18:134 @18:138
ref w_hl #0:49f @18:136 @18:cb
ref byte #0:4a2 @18:139 @10:0 2 +
ref byte #0:4a3 @18:13b @10:0 2 + 1 +
ref w_hl #0:4a4 @18:13d _free_tx_buf
ref w_hl #0:4a7 @18:142 _close_socket_udp
ref w_hl #0:4c9 @1a:6 __mul_i2
ref byte #0:4ca @1a:9 _uc_socket 12 + 8 >> 255 &
ref byte #0:4cb @1a:b _uc_socket 12 + 255 &
ref w_hl #0:4d4 @1a:17 __ld_dptr_r67
ref rbyte #0:4d8 @1a:1e @1a:2b
ref w_hl #0:4da @1a:20 _rcv_buf 16 +
ref w_hl #0:4db @1a:23 __ld_dptr_r47
ref w_hl #0:4dc @1a:26 _my_ip
ref w_hl #0:4dd @1a:29 __st_dptr_r47
ref byte #0:4e3 @1a:2d @19:0 0 +
ref byte #0:4e5 @1a:2f _rcv_buf 8 >> 255 &
ref byte #0:4e6 @1a:31 _rcv_buf 255 &
ref byte #0:4f0 @1a:3a @19:0 1 +
ref byte #0:4f1 @1a:3c @19:0 1 + 1 +
ref w_hl #0:4f3 @1a:3e _rcv_len
ref w_hl #0:4f4 @1a:41 __ld_dptr_r67
ref byte #0:4fb @1a:4c @19:0 1 + 1 +
ref byte #0:4fe @1a:50 @19:0 1 +
ref byte #0:502 @1a:54 @19:0 3 +
ref byte #0:503 @1a:56 @19:0 3 + 1 +
ref w_hl #0:504 @1a:58 @1a:126
ref byte #0:507 @1a:5b @19:0 1 +
ref byte #0:508 @1a:5e @19:0 1 + 1 +
ref byte #0:50b @1a:65 @19:0 1 + 1 +
ref byte #0:50e @1a:6a @19:0 1 +
ref rbyte #0:512 @1a:70 @1a:9a
ref rbyte #0:517 @1a:77 @1a:8e
ref rbyte #0:519 @1a:7a @1a:7e
ref w_hl #0:51a @1a:7c @1a:126
ref rbyte #0:51e @1a:82 @1a:b9
ref rbyte #0:521 @1a:87 @1a:8b
ref w_hl #0:522 @1a:89 @1a:e0
ref w_hl #0:524 @1a:8c @1a:107
ref rbyte #0:528 @1a:91 @1a:95
ref w_hl #0:529 @1a:93 @1a:107
ref byte #0:52d @1a:96 @19:0 0 +
ref w_hl #0:52e @1a:98 @1a:141
ref byte #0:532 @1a:9b @19:0 1 +
ref byte #0:533 @1a:9d @19:0 1 + 1 +
ref rbyte #0:536 @1a:a1 @1a:a3
ref byte #0:53f @1a:ac @19:0 1 + 1 +
ref byte #0:542 @1a:b1 @19:0 1 +
ref byte #0:545 @1a:b5 @19:0 0 +
ref w_hl #0:547 @1a:b7 @1a:126
ref byte #0:54c @1a:bc @19:0 1 + 1 +
ref byte #0:54d @1a:be @19:0 5 + 1 +
ref byte #0:54f @1a:c1 @19:0 1 +
ref byte #0:550 @1a:c3 @19:0 5 +
ref byte #0:554 @1a:c9 _subnet_ip 8 >> 255 &
ref byte #0:555 @1a:cb _subnet_ip 255 &
ref byte #0:556 @1a:cd @19:0 5 +
ref byte #0:557 @1a:cf @19:0 5 + 1 +
ref w_hl #0:558 @1a:d1 _xram_fast_copy
ref byte #0:55b @1a:d6 @19:0 5 + 1 +
ref byte #0:55c @1a:d8 @19:0 1 + 1 +
ref byte #0:55e @1a:db @19:0 5 +
ref byte #0:55f @1a:dd @19:0 1 +
ref rbyte #0:561 @1a:df @1a:126
ref byte #0:566 @1a:e3 @19:0 1 + 1 +
ref byte #0:567 @1a:e5 @19:0 5 + 1 +
ref byte #0:569 @1a:e8 @19:0 1 +
ref byte #0:56a @1a:ea @19:0 5 +
ref byte #0:56e @1a:f0 _gateway_ip 8 >> 255 &
ref byte #0:56f @1a:f2 _gateway_ip 255 &
ref byte #0:570 @1a:f4 @19:0 5 +
ref byte #0:571 @1a:f6 @19:0 5 + 1 +
ref w_hl #0:572 @1a:f8 _xram_fast_copy
ref byte #0:575 @1a:fd @19:0 5 + 1 +
ref byte #0:576 @1a:ff @19:0 1 + 1 +
ref byte #0:578 @1a:102 @19:0 5 +
ref byte #0:579 @1a:104 @19:0 1 +
ref rbyte #0:57b @1a:106 @1a:126
ref byte #0:57f @1a:108 @19:0 1 +
ref byte #0:580 @1a:10b @19:0 1 + 1 +
ref byte #0:595 @1a:123 @19:0 1 +
ref byte #0:596 @1a:125 @19:0 1 + 1 +
ref byte #0:59c @1a:127 @19:0 3 +
ref byte #0:59d @1a:129 @19:0 3 + 1 +
ref byte #0:5a1 @1a:131 @19:0 1 +
ref byte #0:5a2 @1a:133 @19:0 1 + 1 +
ref w_hl #0:5a5 @1a:138 __cmp_u4
ref rbyte #0:5a6 @1a:13b @1a:13f
ref w_hl #0:5a7 @1a:13d @1a:5a
ref byte #0:5aa @1a:140 @19:0 0 +
objectdebug
dtx ; *** 'C:\uC51\bin\uc51.exe': uC/51 - ANSI C compiler
dtx ; *** Standard 'i8051', V1.25, Jan 24 2004 (C) WWW.WICKENHAEUSER.COM
dtx ; sourcefile: 'tcpip\dhcp.c', time: Thu Dec 14 11:33:34 2006
dtx 
dtx  .hide
dtx  .show
dtx XDS=0
dtx COS=1
dtx NES=2
dtx INS=2
dtx .macro __line
dtx lcall $0006 ; uC/51 debugger
dtx .endmacro
dtx         .include <reg51.def>
dtx ; **** 8051 standard defs ***
dtx ; common registers to all 8051's
dtx         .hide
dtx         .show
dtx         .include <reg52.def>
dtx ; **** 80C52 (extended) defs ***
dtx 
dtx         .hide
dtx         .show
dtx  .export _send_DHCP_DISCOVER ; void send_DHCP_DISCOVER(unsigned char, xdata unsigned char *)
dtx  .hide
dtx  .show
dtx 
dtx  .segment __send_DHCP_DISCOVER
dtx _send_DHCP_DISCOVER: ; void send_DHCP_DISCOVER(unsigned char, xdata unsigned char *)
dtx  ; parameter 'pBfr' in 'RW45' moved and assigned to local '?send_DHCP_DISCOVER_pBfr'
dtx  ; parameter 'sock' in 'R7' moved and assigned to local '?send_DHCP_DISCOVER_sock'
dco @5:0 u:2  mov ?send_DHCP_DISCOVER_pBfr,R4
dco @5:2 u:2  mov ?send_DHCP_DISCOVER_pBfr+1,R5
dco @5:4 u:2  mov ?send_DHCP_DISCOVER_sock,R7
dhl /* $Workfile:   dhcp.c $                                                                              
dhl /* $Revision: 1.1 $                                             */
dhl /* $Author: hse00045 $                                                                                
dhl /* $Date: 2003/14/02 19:31:38 $                                                                       
dhl /* Description: DHCP Client                                     */
dhl /*                                                                                                    
dhl /* Remarks:     No remarks.                                     */
dhl /*
dhl DESCRIPTION :  DHCP protocol messaging flow
dhl                              |                      |
dhl                              |   DHCP DISCOVER      |
dhl                              |--------------------->|
dhl                              |      DHCP OFFER      |
dhl                 DHCP Client  |<---------------------|  DHCP SERVER
dhl                              |   DHCP REQUEST       |
dhl                              |--------------------->|
dhl                              |   DHCP ACK           |
dhl                              |<---------------------|
dhl                              |                          |
dhl */
dhl #include <reg52.h>
dhl #include <stdio.h>
dhl #include <ctype.h>
dhl #include <string.h>
dhl #include "net.h"
dhl #include "netutil.h"
dhl #include "dhcp.h"
dhl 
dhl 
dhl // Create Discover DHCP packet and broadcast it.
dhl void send_DHCP_DISCOVER(uchar sock,xdata uchar *pBfr)
dhl {
dco @5:6 u:3  mov DPH,?send_DHCP_DISCOVER_pBfr
dco @5:9 u:3  mov DPL,?send_DHCP_DISCOVER_pBfr+1
dco @5:c u:2  mov A,#1
dco @5:e u:1  movx @DPTR,A
dhl    
dhl         #define MSG ((xdata RIP_MSG*) pBfr)
dhl         // Generate DISCOVER DHCP PACKET
dhl         // setting values as DHCP Protocol
dhl         MSG->op = DHCP_BOOTREQUEST;
dhl         MSG->htype = DHCP_HTYPE10MB;
dco @5:f u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:11 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:13 u:1  inc R7
dco @5:14 u:1  mov A,R7
dco @5:15 u:2  jnz ?__1
dco @5:17 u:1  inc R6
dtx ?__1:
dco @5:18 u:3  mov DPH,AR6
dco @5:1b u:3  mov DPL,AR7
dco @5:1e u:2  mov A,#1
dco @5:20 u:1  movx @DPTR,A
dhl         MSG->hlen = DHCP_HLENETHERNET;
dco @5:21 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:23 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:25 u:2  mov A,#2
dco @5:27 u:1  add A,R7
dco @5:28 u:1  mov R7,A
dco @5:29 u:1  clr A
dco @5:2a u:1  addc A,R6
dco @5:2b u:1  mov R6,A
dco @5:2c u:3  mov DPH,AR6
dco @5:2f u:3  mov DPL,AR7
dco @5:32 u:2  mov A,#6
dco @5:34 u:1  movx @DPTR,A
dhl         MSG->hops = DHCP_HOPS;
dco @5:35 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:37 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:39 u:2  mov A,#3
dco @5:3b u:1  add A,R7
dco @5:3c u:1  mov R7,A
dco @5:3d u:1  clr A
dco @5:3e u:1  addc A,R6
dco @5:3f u:1  mov R6,A
dco @5:40 u:3  mov DPH,AR6
dco @5:43 u:3  mov DPL,AR7
dco @5:46 u:1  clr A
dco @5:47 u:1  movx @DPTR,A
dhl         MSG->xid = DHCP_XID;
dco @5:48 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:4a u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:4c u:2  mov A,#4
dco @5:4e u:1  add A,R7
dco @5:4f u:1  mov R3,A
dco @5:50 u:1  clr A
dco @5:51 u:1  addc A,R6
dco @5:52 u:1  mov R2,A
dco @5:53 u:2  mov R4,#18
dco @5:55 u:2  mov R5,#52
dco @5:57 u:2  mov R6,#86
dco @5:59 u:2  mov R7,#112
dco @5:5b u:2  mov DPH,R2
dco @5:5d u:2  mov DPL,R3
dco @5:5f u:3  lcall __st_dptr_r47
dhl         MSG->secs = DHCP_SECS;
dco @5:62 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:64 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:66 u:2  mov A,#8
dco @5:68 u:1  add A,R7
dco @5:69 u:1  mov R5,A
dco @5:6a u:1  clr A
dco @5:6b u:1  addc A,R6
dco @5:6c u:1  mov R4,A
dco @5:6d u:1  clr A
dco @5:6e u:1  mov R6,A
dco @5:6f u:1  mov R7,A
dco @5:70 u:2  mov DPH,R4
dco @5:72 u:2  mov DPL,R5
dco @5:74 u:3  lcall __st_dptr_r67
dhl         MSG->flags = 0; //DHCP_FLAGSBROADCAST;
dco @5:77 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:79 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:7b u:2  mov A,#10
dco @5:7d u:1  add A,R7
dco @5:7e u:1  mov R5,A
dco @5:7f u:1  clr A
dco @5:80 u:1  addc A,R6
dco @5:81 u:1  mov R4,A
dco @5:82 u:1  clr A
dco @5:83 u:1  mov R6,A
dco @5:84 u:1  mov R7,A
dco @5:85 u:2  mov DPH,R4
dco @5:87 u:2  mov DPL,R5
dco @5:89 u:3  lcall __st_dptr_r67
dhl   
dhl         memset(MSG->ciaddr,0,RIP_MSG_SIZE-12);
dco @5:8c u:2  mov R2,#2
dco @5:8e u:2  mov R3,#24
dco @5:90 u:1  clr A
dco @5:91 u:1  mov R5,A
dco @5:92 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:94 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:96 u:2  mov A,#12
dco @5:98 u:1  add A,R7
dco @5:99 u:1  mov R7,A
dco @5:9a u:1  clr A
dco @5:9b u:1  addc A,R6
dco @5:9c u:1  mov R6,A
dco @5:9d u:3  lcall _memset
dhl 
dhl         // setting default Mac Address Value.
dhl         memcpy(MSG->chaddr,my_mac,6);
dco @5:a0 u:2  mov R2,#0
dco @5:a2 u:2  mov R3,#6
dco @5:a4 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:a6 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:a8 u:2  mov A,#28
dco @5:aa u:1  add A,R7
dco @5:ab u:1  mov R5,A
dco @5:ac u:1  clr A
dco @5:ad u:1  addc A,R6
dco @5:ae u:1  mov R4,A
dco @5:af u:2  mov R6,#((_my_mac)>>8)&255
dco @5:b1 u:2  mov R7,#(_my_mac)&255
dco @5:b3 u:3  lcall _xram_fast_copy
dhl         
dhl         *((xdata unsigned long*)MSG->OPT)=MAGIC_COOKIE;
dco @5:b6 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:b8 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:ba u:2  mov A,#236
dco @5:bc u:1  add A,R7
dco @5:bd u:1  mov R3,A
dco @5:be u:1  clr A
dco @5:bf u:1  addc A,R6
dco @5:c0 u:1  mov R2,A
dco @5:c1 u:2  mov R4,#99
dco @5:c3 u:2  mov R5,#130
dco @5:c5 u:2  mov R6,#83
dco @5:c7 u:2  mov R7,#99
dco @5:c9 u:2  mov DPH,R2
dco @5:cb u:2  mov DPL,R3
dco @5:cd u:3  lcall __st_dptr_r47
dhl         
dhl         // Option Request Param.
dhl         MSG->OPT[4] = dhcpMessageType;
dco @5:d0 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:d2 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:d4 u:2  mov A,#240
dco @5:d6 u:1  add A,R7
dco @5:d7 u:1  mov R7,A
dco @5:d8 u:1  clr A
dco @5:d9 u:1  addc A,R6
dco @5:da u:1  mov R6,A
dco @5:db u:3  mov DPH,AR6
dco @5:de u:3  mov DPL,AR7
dco @5:e1 u:2  mov A,#53
dco @5:e3 u:1  movx @DPTR,A
dhl         MSG->OPT[5] = 0x01;
dco @5:e4 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:e6 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:e8 u:2  mov A,#241
dco @5:ea u:1  add A,R7
dco @5:eb u:1  mov R7,A
dco @5:ec u:1  clr A
dco @5:ed u:1  addc A,R6
dco @5:ee u:1  mov R6,A
dco @5:ef u:3  mov DPH,AR6
dco @5:f2 u:3  mov DPL,AR7
dco @5:f5 u:2  mov A,#1
dco @5:f7 u:1  movx @DPTR,A
dhl         MSG->OPT[6] = DHCP_DISCOVER;
dco @5:f8 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:fa u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:fc u:2  mov A,#242
dco @5:fe u:1  add A,R7
dco @5:ff u:1  mov R7,A
dco @5:100 u:1  clr A
dco @5:101 u:1  addc A,R6
dco @5:102 u:1  mov R6,A
dco @5:103 u:3  mov DPH,AR6
dco @5:106 u:3  mov DPL,AR7
dco @5:109 u:2  mov A,#1
dco @5:10b u:1  movx @DPTR,A
dhl         MSG->OPT[7] = dhcpParamRequest;
dco @5:10c u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:10e u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:110 u:2  mov A,#243
dco @5:112 u:1  add A,R7
dco @5:113 u:1  mov R7,A
dco @5:114 u:1  clr A
dco @5:115 u:1  addc A,R6
dco @5:116 u:1  mov R6,A
dco @5:117 u:3  mov DPH,AR6
dco @5:11a u:3  mov DPL,AR7
dco @5:11d u:2  mov A,#55
dco @5:11f u:1  movx @DPTR,A
dhl         MSG->OPT[8] = 0x05;
dco @5:120 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:122 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:124 u:2  mov A,#244
dco @5:126 u:1  add A,R7
dco @5:127 u:1  mov R7,A
dco @5:128 u:1  clr A
dco @5:129 u:1  addc A,R6
dco @5:12a u:1  mov R6,A
dco @5:12b u:3  mov DPH,AR6
dco @5:12e u:3  mov DPL,AR7
dco @5:131 u:2  mov A,#5
dco @5:133 u:1  movx @DPTR,A
dhl         MSG->OPT[9] = subnetMask;
dco @5:134 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:136 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:138 u:2  mov A,#245
dco @5:13a u:1  add A,R7
dco @5:13b u:1  mov R7,A
dco @5:13c u:1  clr A
dco @5:13d u:1  addc A,R6
dco @5:13e u:1  mov R6,A
dco @5:13f u:3  mov DPH,AR6
dco @5:142 u:3  mov DPL,AR7
dco @5:145 u:2  mov A,#1
dco @5:147 u:1  movx @DPTR,A
dhl         MSG->OPT[10] = routersOnSubnet;
dco @5:148 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:14a u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:14c u:2  mov A,#246
dco @5:14e u:1  add A,R7
dco @5:14f u:1  mov R7,A
dco @5:150 u:1  clr A
dco @5:151 u:1  addc A,R6
dco @5:152 u:1  mov R6,A
dco @5:153 u:3  mov DPH,AR6
dco @5:156 u:3  mov DPL,AR7
dco @5:159 u:2  mov A,#3
dco @5:15b u:1  movx @DPTR,A
dhl         MSG->OPT[11] = dns;
dco @5:15c u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:15e u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:160 u:2  mov A,#247
dco @5:162 u:1  add A,R7
dco @5:163 u:1  mov R7,A
dco @5:164 u:1  clr A
dco @5:165 u:1  addc A,R6
dco @5:166 u:1  mov R6,A
dco @5:167 u:3  mov DPH,AR6
dco @5:16a u:3  mov DPL,AR7
dco @5:16d u:2  mov A,#6
dco @5:16f u:1  movx @DPTR,A
dhl         MSG->OPT[12] = dhcpT1value;
dco @5:170 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:172 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:174 u:2  mov A,#248
dco @5:176 u:1  add A,R7
dco @5:177 u:1  mov R7,A
dco @5:178 u:1  clr A
dco @5:179 u:1  addc A,R6
dco @5:17a u:1  mov R6,A
dco @5:17b u:3  mov DPH,AR6
dco @5:17e u:3  mov DPL,AR7
dco @5:181 u:2  mov A,#58
dco @5:183 u:1  movx @DPTR,A
dhl         MSG->OPT[13] = dhcpT2value;
dco @5:184 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:186 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:188 u:2  mov A,#249
dco @5:18a u:1  add A,R7
dco @5:18b u:1  mov R7,A
dco @5:18c u:1  clr A
dco @5:18d u:1  addc A,R6
dco @5:18e u:1  mov R6,A
dco @5:18f u:3  mov DPH,AR6
dco @5:192 u:3  mov DPL,AR7
dco @5:195 u:2  mov A,#59
dco @5:197 u:1  movx @DPTR,A
dhl         
dhl   MSG->OPT[14]= hostName;
dco @5:198 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:19a u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:19c u:2  mov A,#250
dco @5:19e u:1  add A,R7
dco @5:19f u:1  mov R7,A
dco @5:1a0 u:1  clr A
dco @5:1a1 u:1  addc A,R6
dco @5:1a2 u:1  mov R6,A
dco @5:1a3 u:3  mov DPH,AR6
dco @5:1a6 u:3  mov DPL,AR7
dco @5:1a9 u:2  mov A,#12
dco @5:1ab u:1  movx @DPTR,A
dhl   MSG->OPT[15]= 4;
dco @5:1ac u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:1ae u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:1b0 u:2  mov A,#251
dco @5:1b2 u:1  add A,R7
dco @5:1b3 u:1  mov R7,A
dco @5:1b4 u:1  clr A
dco @5:1b5 u:1  addc A,R6
dco @5:1b6 u:1  mov R6,A
dco @5:1b7 u:3  mov DPH,AR6
dco @5:1ba u:3  mov DPL,AR7
dco @5:1bd u:2  mov A,#4
dco @5:1bf u:1  movx @DPTR,A
dhl   
dhl //      memcpy(&MSG->OPT[16],"FPGA",4); // fucking compiler
dhl   MSG->OPT[16] = 'F';
dco @5:1c0 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:1c2 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:1c4 u:2  mov A,#252
dco @5:1c6 u:1  add A,R7
dco @5:1c7 u:1  mov R7,A
dco @5:1c8 u:1  clr A
dco @5:1c9 u:1  addc A,R6
dco @5:1ca u:1  mov R6,A
dco @5:1cb u:3  mov DPH,AR6
dco @5:1ce u:3  mov DPL,AR7
dco @5:1d1 u:2  mov A,#70
dco @5:1d3 u:1  movx @DPTR,A
dhl   MSG->OPT[17] = 'P';
dco @5:1d4 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:1d6 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:1d8 u:2  mov A,#253
dco @5:1da u:1  add A,R7
dco @5:1db u:1  mov R7,A
dco @5:1dc u:1  clr A
dco @5:1dd u:1  addc A,R6
dco @5:1de u:1  mov R6,A
dco @5:1df u:3  mov DPH,AR6
dco @5:1e2 u:3  mov DPL,AR7
dco @5:1e5 u:2  mov A,#80
dco @5:1e7 u:1  movx @DPTR,A
dhl   MSG->OPT[18] = 'G';
dco @5:1e8 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:1ea u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:1ec u:2  mov A,#254
dco @5:1ee u:1  add A,R7
dco @5:1ef u:1  mov R7,A
dco @5:1f0 u:1  clr A
dco @5:1f1 u:1  addc A,R6
dco @5:1f2 u:1  mov R6,A
dco @5:1f3 u:3  mov DPH,AR6
dco @5:1f6 u:3  mov DPL,AR7
dco @5:1f9 u:2  mov A,#71
dco @5:1fb u:1  movx @DPTR,A
dhl   MSG->OPT[19] = 'A';
dco @5:1fc u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:1fe u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:200 u:2  mov A,#255
dco @5:202 u:1  add A,R7
dco @5:203 u:1  mov R7,A
dco @5:204 u:1  clr A
dco @5:205 u:1  addc A,R6
dco @5:206 u:1  mov R6,A
dco @5:207 u:3  mov DPH,AR6
dco @5:20a u:3  mov DPL,AR7
dco @5:20d u:2  mov A,#65
dco @5:20f u:1  movx @DPTR,A
dhl         MSG->OPT[20] = endOption;
dco @5:210 u:2  mov R6,?send_DHCP_DISCOVER_pBfr
dco @5:212 u:2  mov R7,?send_DHCP_DISCOVER_pBfr+1
dco @5:214 u:1  clr A
dco @5:215 u:1  add A,R7
dco @5:216 u:1  mov R7,A
dco @5:217 u:2  mov A,#1
dco @5:219 u:1  addc A,R6
dco @5:21a u:1  mov R6,A
dco @5:21b u:3  mov DPH,AR6
dco @5:21e u:3  mov DPL,AR7
dco @5:221 u:2  mov A,#255
dco @5:223 u:1  movx @DPTR,A
dhl         send_socket_udp(sock,pBfr,RIP_MSG_SIZE);
dco @5:224 u:2  mov R2,#2
dco @5:226 u:2  mov R3,#36
dco @5:228 u:2  mov R4,?send_DHCP_DISCOVER_pBfr
dco @5:22a u:2  mov R5,?send_DHCP_DISCOVER_pBfr+1
dco @5:22c u:2  mov R7,?send_DHCP_DISCOVER_sock
dco @5:22e u:3  lcall _send_socket_udp
dco @5:231 u:1  ret
dtx ; end of function send_DHCP_DISCOVER
dtx ; used: R01234567 BR01234567 DPTR ACC PSW B locals:3 bytes
dtx 
dtx  .export _send_DHCP_REQUEST ; void send_DHCP_REQUEST(unsigned char, xdata unsigned char *)
dtx  .hide
dtx  .show
dtx 
dtx  .segment __send_DHCP_REQUEST
dtx _send_DHCP_REQUEST: ; void send_DHCP_REQUEST(unsigned char, xdata unsigned char *)
dtx  ; parameter 'pBfr' in 'RW45' moved and assigned to local '?send_DHCP_REQUEST_pBfr'
dtx  ; parameter 'sock' in 'R7' moved and assigned to local '?send_DHCP_REQUEST_sock'
dco @8:0 u:2  mov ?send_DHCP_REQUEST_pBfr,R4
dco @8:2 u:2  mov ?send_DHCP_REQUEST_pBfr+1,R5
dco @8:4 u:2  mov ?send_DHCP_REQUEST_sock,R7
dhl }
dhl 
dhl 
dhl void send_DHCP_REQUEST(uchar sock,xdata uchar *pBfr)
dhl {
dco @8:6 u:3  mov DPH,?send_DHCP_REQUEST_pBfr
dco @8:9 u:3  mov DPL,?send_DHCP_REQUEST_pBfr+1
dco @8:c u:2  mov A,#1
dco @8:e u:1  movx @DPTR,A
dhl //      uint i;
dhl         #define MSG ((xdata RIP_MSG*) pBfr)
dhl 
dhl         MSG->op = DHCP_BOOTREQUEST;
dhl         MSG->htype = DHCP_HTYPE10MB;
dco @8:f u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:11 u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:13 u:1  inc R7
dco @8:14 u:1  mov A,R7
dco @8:15 u:2  jnz ?__2
dco @8:17 u:1  inc R6
dtx ?__2:
dco @8:18 u:3  mov DPH,AR6
dco @8:1b u:3  mov DPL,AR7
dco @8:1e u:2  mov A,#1
dco @8:20 u:1  movx @DPTR,A
dhl         MSG->hlen = DHCP_HLENETHERNET;
dco @8:21 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:23 u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:25 u:2  mov A,#2
dco @8:27 u:1  add A,R7
dco @8:28 u:1  mov R7,A
dco @8:29 u:1  clr A
dco @8:2a u:1  addc A,R6
dco @8:2b u:1  mov R6,A
dco @8:2c u:3  mov DPH,AR6
dco @8:2f u:3  mov DPL,AR7
dco @8:32 u:2  mov A,#6
dco @8:34 u:1  movx @DPTR,A
dhl         MSG->hops = DHCP_HOPS;
dco @8:35 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:37 u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:39 u:2  mov A,#3
dco @8:3b u:1  add A,R7
dco @8:3c u:1  mov R7,A
dco @8:3d u:1  clr A
dco @8:3e u:1  addc A,R6
dco @8:3f u:1  mov R6,A
dco @8:40 u:3  mov DPH,AR6
dco @8:43 u:3  mov DPL,AR7
dco @8:46 u:1  clr A
dco @8:47 u:1  movx @DPTR,A
dhl         MSG->xid = DHCP_XID;
dco @8:48 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:4a u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:4c u:2  mov A,#4
dco @8:4e u:1  add A,R7
dco @8:4f u:1  mov R3,A
dco @8:50 u:1  clr A
dco @8:51 u:1  addc A,R6
dco @8:52 u:1  mov R2,A
dco @8:53 u:2  mov R4,#18
dco @8:55 u:2  mov R5,#52
dco @8:57 u:2  mov R6,#86
dco @8:59 u:2  mov R7,#112
dco @8:5b u:2  mov DPH,R2
dco @8:5d u:2  mov DPL,R3
dco @8:5f u:3  lcall __st_dptr_r47
dhl         MSG->secs = DHCP_SECS;
dco @8:62 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:64 u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:66 u:2  mov A,#8
dco @8:68 u:1  add A,R7
dco @8:69 u:1  mov R5,A
dco @8:6a u:1  clr A
dco @8:6b u:1  addc A,R6
dco @8:6c u:1  mov R4,A
dco @8:6d u:1  clr A
dco @8:6e u:1  mov R6,A
dco @8:6f u:1  mov R7,A
dco @8:70 u:2  mov DPH,R4
dco @8:72 u:2  mov DPL,R5
dco @8:74 u:3  lcall __st_dptr_r67
dhl         MSG->flags = DHCP_FLAGSBROADCAST;
dco @8:77 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:79 u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:7b u:2  mov A,#10
dco @8:7d u:1  add A,R7
dco @8:7e u:1  mov R5,A
dco @8:7f u:1  clr A
dco @8:80 u:1  addc A,R6
dco @8:81 u:1  mov R4,A
dco @8:82 u:2  mov R6,#128
dco @8:84 u:2  mov R7,#0
dco @8:86 u:2  mov DPH,R4
dco @8:88 u:2  mov DPL,R5
dco @8:8a u:3  lcall __st_dptr_r67
dhl 
dhl         *((xdata unsigned long*)MSG->ciaddr)=my_ip.ipl;
dco @8:8d u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:8f u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:91 u:2  mov A,#12
dco @8:93 u:1  add A,R7
dco @8:94 u:1  mov R3,A
dco @8:95 u:1  clr A
dco @8:96 u:1  addc A,R6
dco @8:97 u:1  mov R2,A
dco @8:98 u:3  mov DPTR,#_my_ip
dco @8:9b u:3  lcall __ld_dptr_r47
dco @8:9e u:2  mov DPH,R2
dco @8:a0 u:2  mov DPL,R3
dco @8:a2 u:3  lcall __st_dptr_r47
dhl         memset(MSG->yiaddr,0,RIP_MSG_SIZE-16);
dco @8:a5 u:2  mov R2,#2
dco @8:a7 u:2  mov R3,#20
dco @8:a9 u:1  clr A
dco @8:aa u:1  mov R5,A
dco @8:ab u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:ad u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:af u:2  mov A,#16
dco @8:b1 u:1  add A,R7
dco @8:b2 u:1  mov R7,A
dco @8:b3 u:1  clr A
dco @8:b4 u:1  addc A,R6
dco @8:b5 u:1  mov R6,A
dco @8:b6 u:3  lcall _memset
dhl         memcpy(MSG->chaddr,my_mac,6);
dco @8:b9 u:2  mov R2,#0
dco @8:bb u:2  mov R3,#6
dco @8:bd u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:bf u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:c1 u:2  mov A,#28
dco @8:c3 u:1  add A,R7
dco @8:c4 u:1  mov R5,A
dco @8:c5 u:1  clr A
dco @8:c6 u:1  addc A,R6
dco @8:c7 u:1  mov R4,A
dco @8:c8 u:2  mov R6,#((_my_mac)>>8)&255
dco @8:ca u:2  mov R7,#(_my_mac)&255
dco @8:cc u:3  lcall _xram_fast_copy
dhl         *((xdata unsigned long *)MSG->OPT)=MAGIC_COOKIE;
dco @8:cf u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:d1 u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:d3 u:2  mov A,#236
dco @8:d5 u:1  add A,R7
dco @8:d6 u:1  mov R3,A
dco @8:d7 u:1  clr A
dco @8:d8 u:1  addc A,R6
dco @8:d9 u:1  mov R2,A
dco @8:da u:2  mov R4,#99
dco @8:dc u:2  mov R5,#130
dco @8:de u:2  mov R6,#83
dco @8:e0 u:2  mov R7,#99
dco @8:e2 u:2  mov DPH,R2
dco @8:e4 u:2  mov DPL,R3
dco @8:e6 u:3  lcall __st_dptr_r47
dhl 
dhl         // Option Request Param.
dhl         MSG->OPT[4] = dhcpMessageType;
dco @8:e9 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:eb u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:ed u:2  mov A,#240
dco @8:ef u:1  add A,R7
dco @8:f0 u:1  mov R7,A
dco @8:f1 u:1  clr A
dco @8:f2 u:1  addc A,R6
dco @8:f3 u:1  mov R6,A
dco @8:f4 u:3  mov DPH,AR6
dco @8:f7 u:3  mov DPL,AR7
dco @8:fa u:2  mov A,#53
dco @8:fc u:1  movx @DPTR,A
dhl         MSG->OPT[5] = 0x01;
dco @8:fd u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:ff u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:101 u:2  mov A,#241
dco @8:103 u:1  add A,R7
dco @8:104 u:1  mov R7,A
dco @8:105 u:1  clr A
dco @8:106 u:1  addc A,R6
dco @8:107 u:1  mov R6,A
dco @8:108 u:3  mov DPH,AR6
dco @8:10b u:3  mov DPL,AR7
dco @8:10e u:2  mov A,#1
dco @8:110 u:1  movx @DPTR,A
dhl         MSG->OPT[6] = DHCP_REQUEST;
dco @8:111 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:113 u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:115 u:2  mov A,#242
dco @8:117 u:1  add A,R7
dco @8:118 u:1  mov R7,A
dco @8:119 u:1  clr A
dco @8:11a u:1  addc A,R6
dco @8:11b u:1  mov R6,A
dco @8:11c u:3  mov DPH,AR6
dco @8:11f u:3  mov DPL,AR7
dco @8:122 u:2  mov A,#3
dco @8:124 u:1  movx @DPTR,A
dhl 
dhl         // DHCP Option Request Param.
dhl         MSG->OPT[7] = dhcpParamRequest;
dco @8:125 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:127 u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:129 u:2  mov A,#243
dco @8:12b u:1  add A,R7
dco @8:12c u:1  mov R7,A
dco @8:12d u:1  clr A
dco @8:12e u:1  addc A,R6
dco @8:12f u:1  mov R6,A
dco @8:130 u:3  mov DPH,AR6
dco @8:133 u:3  mov DPL,AR7
dco @8:136 u:2  mov A,#55
dco @8:138 u:1  movx @DPTR,A
dhl         MSG->OPT[8] = 0x05;
dco @8:139 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:13b u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:13d u:2  mov A,#244
dco @8:13f u:1  add A,R7
dco @8:140 u:1  mov R7,A
dco @8:141 u:1  clr A
dco @8:142 u:1  addc A,R6
dco @8:143 u:1  mov R6,A
dco @8:144 u:3  mov DPH,AR6
dco @8:147 u:3  mov DPL,AR7
dco @8:14a u:2  mov A,#5
dco @8:14c u:1  movx @DPTR,A
dhl         MSG->OPT[9] = subnetMask;
dco @8:14d u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:14f u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:151 u:2  mov A,#245
dco @8:153 u:1  add A,R7
dco @8:154 u:1  mov R7,A
dco @8:155 u:1  clr A
dco @8:156 u:1  addc A,R6
dco @8:157 u:1  mov R6,A
dco @8:158 u:3  mov DPH,AR6
dco @8:15b u:3  mov DPL,AR7
dco @8:15e u:2  mov A,#1
dco @8:160 u:1  movx @DPTR,A
dhl         MSG->OPT[10] = routersOnSubnet;
dco @8:161 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:163 u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:165 u:2  mov A,#246
dco @8:167 u:1  add A,R7
dco @8:168 u:1  mov R7,A
dco @8:169 u:1  clr A
dco @8:16a u:1  addc A,R6
dco @8:16b u:1  mov R6,A
dco @8:16c u:3  mov DPH,AR6
dco @8:16f u:3  mov DPL,AR7
dco @8:172 u:2  mov A,#3
dco @8:174 u:1  movx @DPTR,A
dhl 
dhl         MSG->OPT[11] = dns;
dco @8:175 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:177 u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:179 u:2  mov A,#247
dco @8:17b u:1  add A,R7
dco @8:17c u:1  mov R7,A
dco @8:17d u:1  clr A
dco @8:17e u:1  addc A,R6
dco @8:17f u:1  mov R6,A
dco @8:180 u:3  mov DPH,AR6
dco @8:183 u:3  mov DPL,AR7
dco @8:186 u:2  mov A,#6
dco @8:188 u:1  movx @DPTR,A
dhl         MSG->OPT[12] = dhcpT1value;
dco @8:189 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:18b u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:18d u:2  mov A,#248
dco @8:18f u:1  add A,R7
dco @8:190 u:1  mov R7,A
dco @8:191 u:1  clr A
dco @8:192 u:1  addc A,R6
dco @8:193 u:1  mov R6,A
dco @8:194 u:3  mov DPH,AR6
dco @8:197 u:3  mov DPL,AR7
dco @8:19a u:2  mov A,#58
dco @8:19c u:1  movx @DPTR,A
dhl         MSG->OPT[13] = dhcpT2value;
dco @8:19d u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:19f u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:1a1 u:2  mov A,#249
dco @8:1a3 u:1  add A,R7
dco @8:1a4 u:1  mov R7,A
dco @8:1a5 u:1  clr A
dco @8:1a6 u:1  addc A,R6
dco @8:1a7 u:1  mov R6,A
dco @8:1a8 u:3  mov DPH,AR6
dco @8:1ab u:3  mov DPL,AR7
dco @8:1ae u:2  mov A,#59
dco @8:1b0 u:1  movx @DPTR,A
dhl 
dhl   MSG->OPT[14]= hostName;
dco @8:1b1 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:1b3 u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:1b5 u:2  mov A,#250
dco @8:1b7 u:1  add A,R7
dco @8:1b8 u:1  mov R7,A
dco @8:1b9 u:1  clr A
dco @8:1ba u:1  addc A,R6
dco @8:1bb u:1  mov R6,A
dco @8:1bc u:3  mov DPH,AR6
dco @8:1bf u:3  mov DPL,AR7
dco @8:1c2 u:2  mov A,#12
dco @8:1c4 u:1  movx @DPTR,A
dhl   MSG->OPT[15]= 4;
dco @8:1c5 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:1c7 u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:1c9 u:2  mov A,#251
dco @8:1cb u:1  add A,R7
dco @8:1cc u:1  mov R7,A
dco @8:1cd u:1  clr A
dco @8:1ce u:1  addc A,R6
dco @8:1cf u:1  mov R6,A
dco @8:1d0 u:3  mov DPH,AR6
dco @8:1d3 u:3  mov DPL,AR7
dco @8:1d6 u:2  mov A,#4
dco @8:1d8 u:1  movx @DPTR,A
dhl //      memcpy(&MSG->OPT[16],"FPGA",4);   // never seen such a stupid compiler before :-(
dhl   MSG->OPT[16] = 'F';
dco @8:1d9 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:1db u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:1dd u:2  mov A,#252
dco @8:1df u:1  add A,R7
dco @8:1e0 u:1  mov R7,A
dco @8:1e1 u:1  clr A
dco @8:1e2 u:1  addc A,R6
dco @8:1e3 u:1  mov R6,A
dco @8:1e4 u:3  mov DPH,AR6
dco @8:1e7 u:3  mov DPL,AR7
dco @8:1ea u:2  mov A,#70
dco @8:1ec u:1  movx @DPTR,A
dhl   MSG->OPT[17] = 'P';
dco @8:1ed u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:1ef u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:1f1 u:2  mov A,#253
dco @8:1f3 u:1  add A,R7
dco @8:1f4 u:1  mov R7,A
dco @8:1f5 u:1  clr A
dco @8:1f6 u:1  addc A,R6
dco @8:1f7 u:1  mov R6,A
dco @8:1f8 u:3  mov DPH,AR6
dco @8:1fb u:3  mov DPL,AR7
dco @8:1fe u:2  mov A,#80
dco @8:200 u:1  movx @DPTR,A
dhl   MSG->OPT[18] = 'G';
dco @8:201 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:203 u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:205 u:2  mov A,#254
dco @8:207 u:1  add A,R7
dco @8:208 u:1  mov R7,A
dco @8:209 u:1  clr A
dco @8:20a u:1  addc A,R6
dco @8:20b u:1  mov R6,A
dco @8:20c u:3  mov DPH,AR6
dco @8:20f u:3  mov DPL,AR7
dco @8:212 u:2  mov A,#71
dco @8:214 u:1  movx @DPTR,A
dhl   MSG->OPT[19] = 'A';
dco @8:215 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:217 u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:219 u:2  mov A,#255
dco @8:21b u:1  add A,R7
dco @8:21c u:1  mov R7,A
dco @8:21d u:1  clr A
dco @8:21e u:1  addc A,R6
dco @8:21f u:1  mov R6,A
dco @8:220 u:3  mov DPH,AR6
dco @8:223 u:3  mov DPL,AR7
dco @8:226 u:2  mov A,#65
dco @8:228 u:1  movx @DPTR,A
dhl         MSG->OPT[20] = endOption;
dco @8:229 u:2  mov R6,?send_DHCP_REQUEST_pBfr
dco @8:22b u:2  mov R7,?send_DHCP_REQUEST_pBfr+1
dco @8:22d u:1  clr A
dco @8:22e u:1  add A,R7
dco @8:22f u:1  mov R7,A
dco @8:230 u:2  mov A,#1
dco @8:232 u:1  addc A,R6
dco @8:233 u:1  mov R6,A
dco @8:234 u:3  mov DPH,AR6
dco @8:237 u:3  mov DPL,AR7
dco @8:23a u:2  mov A,#255
dco @8:23c u:1  movx @DPTR,A
dhl         send_socket_udp(sock,pBfr,RIP_MSG_SIZE);
dco @8:23d u:2  mov R2,#2
dco @8:23f u:2  mov R3,#36
dco @8:241 u:2  mov R4,?send_DHCP_REQUEST_pBfr
dco @8:243 u:2  mov R5,?send_DHCP_REQUEST_pBfr+1
dco @8:245 u:2  mov R7,?send_DHCP_REQUEST_sock
dco @8:247 u:3  lcall _send_socket_udp
dco @8:24a u:1  ret
dtx ; end of function send_DHCP_REQUEST
dtx ; used: R01234567 BR01234567 DPTR ACC PSW B locals:3 bytes
dtx 
dtx  .export _DefaultNetConfig ; void DefaultNetConfig(void)
dtx  .segment _DefaultNetConfig_formal_near, size 0, fill, notext, sclass dram
dtx  .segment _DefaultNetConfig_local_near, size 0, fill, notext, sclass dram
dtx  .sgraph _DefaultNetConfig_formal_near, _DefaultNetConfig_local_near, __DefaultNetConfig
dtx 
dtx  .segment __DefaultNetConfig
dtx _DefaultNetConfig: ; (leaf function) void DefaultNetConfig(void)
dhl }
dhl 
dhl void DefaultNetConfig(void)
dhl {
dco @b:0 u:3  mov DPTR,#_my_ip
dco @b:3 u:2  mov A,#192
dco @b:5 u:1  movx @DPTR,A
dhl         //COMPOSE_IP(my_ip,10,0,0,101);
dhl         COMPOSE_IP(my_ip,192,168,0,1); 
dco @b:6 u:3  mov DPTR,#_my_ip+1
dco @b:9 u:2  mov A,#168
dco @b:b u:1  movx @DPTR,A
dtx 
dco @b:c u:3  mov DPTR,#_my_ip+2
dco @b:f u:1  clr A
dco @b:10 u:1  movx @DPTR,A
dtx 
dco @b:11 u:3  mov DPTR,#_my_ip+3
dco @b:14 u:2  mov A,#1
dco @b:16 u:1  movx @DPTR,A
dco @b:17 u:1  ret
dtx ; end of function DefaultNetConfig
dtx ; used: R-------- BR-------- DPTR ACC
dtx 
dtx  .export _SetupTimer ; void SetupTimer(void)
dtx  .segment _SetupTimer_formal_near, size 0, fill, notext, sclass dram
dtx  .segment _SetupTimer_local_near, size 0, fill, notext, sclass dram
dtx  .sgraph _SetupTimer_formal_near, _SetupTimer_local_near, __SetupTimer
dtx 
dtx  .segment __SetupTimer
dtx _SetupTimer: ; (leaf function) void SetupTimer(void)
dhl }
dhl 
dhl 
dhl void SetupTimer(void) {
dco @e:0 u:2  clr _TF1
dco @e:2 u:2  clr _TR1
dhl         TR1 = TF1 = 0;  // stop timer 1 
dhl         TMOD &= ~0xF0;  // clear timer 1 bits 
dco @e:4 u:3  anl _TMOD,#15
dhl         TMOD |= 0x10;     // 16 bit timer 
dco @e:7 u:3  orl _TMOD,#16
dhl 
dhl         TH1 = 0;
dco @e:a u:1  clr A
dco @e:b u:2  mov _TH1,A
dhl         TL1 = 0;
dco @e:d u:1  clr A
dco @e:e u:2  mov _TL1,A
dhl   TR1 = 1;
dco @e:10 u:2  setb _TR1
dhl   ET1 = 0;
dco @e:12 u:2  clr _ET1
dco @e:14 u:1  ret
dtx ; end of function SetupTimer
dtx ; used: R-------- BR-------- ACC
dtx 
dtx  .export _DHCP_SetIP ; char DHCP_SetIP(void)
dtx  .hide
dtx  .show
dtx 
dtx  .segment __DHCP_SetIP
dtx _DHCP_SetIP: ; char DHCP_SetIP(void)
dtx  ; variable 'type' allocated as 'auto'
dhl }
dhl 
dhl 
dhl char DHCP_SetIP()
dhl {
dco @18:0 u:1  clr A
dco @18:1 u:2  mov ?DHCP_SetIP_type,A
dtx  ; variable 'RetryCnt' allocated as 'auto'
dhl         uchar i;
dhl         uchar RetryCnt;
dhl         uint res;
dhl         uchar type;                     // DHCP message type
dhl         xdata uchar *pbuf;
dhl         unsigned char e;
dhl 
dhl 
dhl         type = 0;
dhl         RetryCnt = 0;
dco @18:3 u:1  clr A
dco @18:4 u:2  mov ?DHCP_SetIP_RetryCnt,A
dhl //      len = 0;
dhl         
dhl         // Discover DHCP server
dhl   SOCKET_SETUP(UDP_SOCK,SOCKET_UDP,68,FLAG_PASSIVE_OPEN);
dco @18:6 u:3  mov DPTR,#_uc_socket+50
dco @18:9 u:2  mov A,#1
dco @18:b u:1  movx @DPTR,A
dtx 
dco @18:c u:3  mov DPTR,#_uc_socket+50+14
dco @18:f u:1  clr A
dco @18:10 u:1  movx @DPTR,A
dco @18:11 u:1  inc DPTR
dco @18:12 u:2  mov A,#68
dco @18:14 u:1  movx @DPTR,A
dtx 
dco @18:15 u:3  mov _open_socket_udp_formal_near,#0
dco @18:18 u:3  mov _open_socket_udp_formal_near+1,#67
dco @18:1b u:2  mov R0,#255
dco @18:1d u:2  mov R1,#255
dco @18:1f u:2  mov R2,#255
dco @18:21 u:2  mov R3,#255
dco @18:23 u:2  mov R7,#1
dco @18:25 u:3  lcall _open_socket_udp
dco @18:28 u:1  mov A,R6
dco @18:29 u:1  orl A,R7
dco @18:2a u:2  jz ?10
dhl         if(open_socket_udp(UDP_SOCK,0xffffffff,67)!=0) { 
dco @18:2c u:2  mov R6,#((?i12)>>8)&255
dco @18:2e u:2  mov R7,#(?i12)&255
dco @18:30 u:2  mov R4,#COS
dco @18:32 u:3  lcall _puts
dhl                 puts("Error opening UDP Socket\r");
dhl                 return 0;
dco @18:35 u:1  clr A
dco @18:36 u:1  mov R7,A
dco @18:37 u:3  ljmp ?9
dtx ?10:
dhl         }
dhl         pbuf=allocate_tx_buf();
dco @18:3a u:3  lcall _allocate_tx_buf
dtx  ; variable 'pbuf' allocated as 'auto'
dco @18:3d u:2  mov ?DHCP_SetIP_pbuf,R6
dco @18:3f u:2  mov ?DHCP_SetIP_pbuf+1,R7
dco @18:41 u:3  ljmp ?14
dtx ?13:
dtx  ; variable 'e' allocated as 'auto'
dhl         while(1)
dhl         {               
dco @18:44 u:1  clr A
dco @18:45 u:2  mov ?DHCP_SetIP_e,A
dhl     e=0;
dhl                 send_DHCP_DISCOVER(UDP_SOCK,pbuf);
dco @18:47 u:2  mov R4,?DHCP_SetIP_pbuf
dco @18:49 u:2  mov R5,?DHCP_SetIP_pbuf+1
dco @18:4b u:2  mov R7,#1
dco @18:4d u:3  lcall _send_DHCP_DISCOVER
dhl     SetupTimer();
dco @18:50 u:3  lcall _SetupTimer
dtx  ; variable 'i' allocated as 'auto'
dhl                 // Check continuously with some delay if OFFER msg arrived from the DHCP server
dhl                 for(i = 0 ; i < 32 && !e; i++)
dco @18:53 u:1  clr A
dco @18:54 u:2  mov ?DHCP_SetIP_i,A
dco @18:56 u:2  sjmp ?19
dtx ?16:
dhl                 {
dco @18:58 u:2  clr _TF1
dco @18:5a u:2  sjmp ?21
dtx ?20:
dhl       TF1=0;
dhl       // wait 1 sec. for an answer to DHCP_DISCOVER message
dhl       while(!TF1) {
dco @18:5c u:3  lcall _poll_net
dco @18:5f u:2  mov R4,AR6
dco @18:61 u:2  mov R5,AR7
dtx  ; variable 'res' assigned to register 'RW45'
dhl                         res=poll_net();
dhl                         if((res&0xff00)==EVENT_UDP_DATARECEIVED)
dco @18:63 u:2  mov R7,#0
dco @18:65 u:1  mov A,R4
dco @18:66 u:1  mov R6,A
dco @18:67 u:3  cjne R7,#0,?23
dco @18:6a u:3  cjne R6,#226,?23
dhl             {
dco @18:6d u:1  mov A,R5
dco @18:6e u:1  mov R7,A
dco @18:6f u:2  mov R6,#0
dco @18:71 u:3  lcall _parseDHCPMSG
dco @18:74 u:2  mov ?DHCP_SetIP_type,R7
dhl                         type = parseDHCPMSG(res&0xff);  
dhl                         if (type == DHCP_OFFER) 
dco @18:76 u:2  mov A,#2
dco @18:78 u:2  xrl A,?DHCP_SetIP_type
dco @18:7a u:2  jnz ?25
dhl                         {
dco @18:7c u:3  mov ?DHCP_SetIP_e,#1
dhl //                              puts("Receive DHCP_OFFER OK\r\n");
dhl               e=1;
dhl                                 break;
dco @18:7f u:2  sjmp ?22
dtx ?25:
dhl                         }
dhl             }
dtx ?23:
dhl //                      __wait_ms(5);           
dhl //                      wait_10ms(5);           // Wait OFFER message
dhl       }
dtx ?21:
dtx 
dco @18:81 u:3  jnb _TF1,?20
dtx ?22:
dhl                 }
dco @18:84 u:2  inc ?DHCP_SetIP_i
dtx ?19:
dtx 
dco @18:86 u:2  mov R5,#32
dco @18:88 u:2  mov R7,?DHCP_SetIP_i
dco @18:8a u:1  clr C
dco @18:8b u:2  mov A,AR7
dco @18:8d u:2  subb A,AR5
dco @18:8f u:2  jnc ?27
dco @18:91 u:2  mov A,?DHCP_SetIP_e
dco @18:93 u:2  jz ?16
dtx ?27:
dhl                 if (type == DHCP_OFFER) {
dco @18:95 u:2  mov A,#2
dco @18:97 u:2  xrl A,?DHCP_SetIP_type
dtx 
dco @18:99 u:2  jz ?15
dhl                         break;
dhl                 }else if ( RetryCnt++ > 10){
dco @18:9b u:2  mov R5,?DHCP_SetIP_RetryCnt
dco @18:9d u:2  mov R7,AR5
dco @18:9f u:1  inc R7
dco @18:a0 u:2  mov ?DHCP_SetIP_RetryCnt,R7
dco @18:a2 u:2  mov R7,#10
dco @18:a4 u:1  setb C
dco @18:a5 u:1  mov A,R5
dco @18:a6 u:1  subb A,R7
dco @18:a7 u:2  jc ?30
dtx 
dco @18:a9 u:2  clr _TR1
dhl //                close(s);
dhl       TR1=0;
dhl                         free_tx_buf(pbuf);
dco @18:ab u:2  mov R6,?DHCP_SetIP_pbuf
dco @18:ad u:2  mov R7,?DHCP_SetIP_pbuf+1
dco @18:af u:3  lcall _free_tx_buf
dhl                         close_socket_udp(UDP_SOCK);
dco @18:b2 u:2  mov R7,#1
dco @18:b4 u:3  lcall _close_socket_udp
dhl                         DefaultNetConfig();
dco @18:b7 u:3  lcall _DefaultNetConfig
dhl                         return 0;
dco @18:ba u:1  clr A
dco @18:bb u:1  mov R7,A
dco @18:bc u:3  ljmp ?9
dtx ?30:
dhl                 }
dhl         }  
dtx ?14:
dtx 
dco @18:bf u:3  ljmp ?13
dtx ?15:
dtx  ; variable 'RetryCnt' allocated as 'auto'
dhl 
dhl         RetryCnt = 0;
dco @18:c2 u:1  clr A
dco @18:c3 u:2  mov ?i51,A
dtx  ; variable 'type' allocated as 'auto'
dhl         type = 0;
dco @18:c5 u:1  clr A
dco @18:c6 u:2  mov ?i52,A
dco @18:c8 u:3  ljmp ?33
dtx ?32:
dtx  ; variable 'e' allocated as 'auto'
dhl //      len = 0;
dhl         
dhl         // After receiving OFFER message, send REQUEST message
dhl         while(1)
dhl         {
dco @18:cb u:1  clr A
dco @18:cc u:2  mov ?i53,A
dhl     e=0;
dhl                 send_DHCP_REQUEST(UDP_SOCK,pbuf);
dco @18:ce u:2  mov R4,?DHCP_SetIP_pbuf
dco @18:d0 u:2  mov R5,?DHCP_SetIP_pbuf+1
dco @18:d2 u:2  mov R7,#1
dco @18:d4 u:3  lcall _send_DHCP_REQUEST
dhl     SetupTimer();
dco @18:d7 u:3  lcall _SetupTimer
dtx  ; variable 'i' allocated as 'auto'
dhl //              puts("Send DHCP REQUEST OK\r\n");
dhl //              wait_10ms(5);           // Wait REQUEST message
dhl                 // Check continuously with some delay if ACK message arrived from the DHCP server
dhl                 for(i = 0 ; i < 32 && !e; i++)
dco @18:da u:1  clr A
dco @18:db u:2  mov ?i54,A
dco @18:dd u:2  sjmp ?38
dtx ?35:
dhl                 {
dco @18:df u:2  clr _TF1
dco @18:e1 u:2  sjmp ?40
dtx ?39:
dhl       TF1=0;
dhl       while(!TF1) {
dco @18:e3 u:3  lcall _poll_net
dco @18:e6 u:2  mov R4,AR6
dco @18:e8 u:2  mov R5,AR7
dtx  ; variable 'res' assigned to register 'RW45'
dhl                         res=poll_net();
dhl                         if((res&0xff00)==EVENT_UDP_DATARECEIVED)
dco @18:ea u:2  mov R7,#0
dco @18:ec u:1  mov A,R4
dco @18:ed u:1  mov R6,A
dco @18:ee u:3  cjne R7,#0,?42
dco @18:f1 u:3  cjne R6,#226,?42
dhl                         {
dco @18:f4 u:1  mov A,R5
dco @18:f5 u:1  mov R7,A
dco @18:f6 u:2  mov R6,#0
dco @18:f8 u:3  lcall _parseDHCPMSG
dco @18:fb u:2  mov ?i52,R7
dhl                                 type = parseDHCPMSG(res&0xff);                          
dhl                                 if (type == DHCP_ACK)
dco @18:fd u:2  mov A,#5
dco @18:ff u:2  xrl A,?i52
dco @18:101 u:2  jnz ?44
dhl                                 {
dco @18:103 u:3  mov ?i53,#1
dhl //                                      puts("Receive DHCP_ACK OK\r\n");
dhl               e=1;
dhl                                         break;
dco @18:106 u:2  sjmp ?41
dtx ?44:
dhl                 }
dhl                         }
dtx ?42:
dhl //                      __wait_ms(5);           
dhl //                      wait_10ms(5);
dhl       }
dtx ?40:
dtx 
dco @18:108 u:3  jnb _TF1,?39
dtx ?41:
dhl                 }       
dco @18:10b u:2  inc ?i54
dtx ?38:
dtx 
dco @18:10d u:2  mov R5,#32
dco @18:10f u:2  mov R7,?i54
dco @18:111 u:1  clr C
dco @18:112 u:2  mov A,AR7
dco @18:114 u:2  subb A,AR5
dco @18:116 u:2  jnc ?46
dco @18:118 u:2  mov A,?i53
dco @18:11a u:2  jz ?35
dtx ?46:
dhl                 if (type == DHCP_ACK) {
dco @18:11c u:2  mov A,#5
dco @18:11e u:2  xrl A,?i52
dtx 
dco @18:120 u:2  jz ?34
dhl                         break;
dhl                 }else if (RetryCnt++ > 10){
dco @18:122 u:2  mov R5,?i51
dco @18:124 u:2  mov R7,AR5
dco @18:126 u:1  inc R7
dco @18:127 u:2  mov ?i51,R7
dco @18:129 u:2  mov R7,#10
dco @18:12b u:1  setb C
dco @18:12c u:1  mov A,R5
dco @18:12d u:1  subb A,R7
dco @18:12e u:2  jc ?49
dtx 
dco @18:130 u:3  lcall _DefaultNetConfig
dhl //                      free_tx_buf(pbuf);
dhl //                      close_socket_udp(UDP_SOCK);
dhl                         DefaultNetConfig();
dhl                         break;
dco @18:133 u:2  sjmp ?34
dtx ?49:
dhl                         
dhl                 }
dhl         }
dtx ?33:
dtx 
dco @18:135 u:3  ljmp ?32
dtx ?34:
dhl 
dhl         free_tx_buf(pbuf);
dco @18:138 u:2  mov R6,?DHCP_SetIP_pbuf
dco @18:13a u:2  mov R7,?DHCP_SetIP_pbuf+1
dco @18:13c u:3  lcall _free_tx_buf
dhl         close_socket_udp(UDP_SOCK);
dco @18:13f u:2  mov R7,#1
dco @18:141 u:3  lcall _close_socket_udp
dhl         // Setup packet information from the server
dhl   TR1=0;
dco @18:144 u:2  clr _TR1
dhl         return 1;
dco @18:146 u:2  mov R7,#1
dtx ?9:
dco @18:148 u:1  ret
dtx ; end of function DHCP_SetIP
dtx ; used: R01234567 BR01234567 DPTR ACC PSW B locals:6 bytes
dtx 
dtx  .export _parseDHCPMSG ; char parseDHCPMSG(unsigned char)
dtx  .hide
dtx  .show
dtx 
dtx  .segment __parseDHCPMSG
dtx _parseDHCPMSG: ; char parseDHCPMSG(unsigned char)
dtx  ; parameter 'sock' in 'R7'
dhl }
dhl 
dhl #define pMSG ((xdata RIP_MSG*) rcv_buf)
dhl char parseDHCPMSG(uchar sock)
dhl {
dco @1a:0 u:1  clr A
dco @1a:1 u:1  mov R6,A
dco @1a:2 u:1  mov R4,A
dco @1a:3 u:2  mov R5,#50
dco @1a:5 u:3  lcall __mul_i2
dco @1a:8 u:2  mov R4,#((_uc_socket+12)>>8)&255
dco @1a:a u:2  mov R5,#(_uc_socket+12)&255
dco @1a:c u:1  mov A,R5
dco @1a:d u:1  add A,R7
dco @1a:e u:1  mov R7,A
dco @1a:f u:1  mov A,R4
dco @1a:10 u:1  addc A,R6
dco @1a:11 u:1  mov R6,A
dco @1a:12 u:2  mov DPH,R6
dco @1a:14 u:2  mov DPL,R7
dco @1a:16 u:3  lcall __ld_dptr_r67
dco @1a:19 u:1  mov A,R7
dco @1a:1a u:2  xrl A,#67
dco @1a:1c u:1  orl A,R6
dco @1a:1d u:2  jnz ?57
dhl         uchar type,opt_len;
dhl         xdata uchar * p;
dhl         xdata uchar * e;
dhl 
dhl         if (uc_socket[sock].sremote_port == DHCP_SERVER_PORT)
dhl         {
dco @1a:1f u:3  mov DPTR,#_rcv_buf+16
dco @1a:22 u:3  lcall __ld_dptr_r47
dco @1a:25 u:3  mov DPTR,#_my_ip
dco @1a:28 u:3  lcall __st_dptr_r47
dhl                 my_ip.ipl=*((xdata unsigned long*)pMSG->yiaddr);
dhl         }
dtx ?57:
dtx  ; variable 'type' allocated as 'auto'
dhl         type = 0;       
dco @1a:2b u:1  clr A
dco @1a:2c u:2  mov ?parseDHCPMSG_type,A
dhl         p = (xdata uchar *)(pMSG);
dco @1a:2e u:2  mov R6,#((_rcv_buf)>>8)&255
dco @1a:30 u:2  mov R7,#(_rcv_buf)&255
dtx  ; variable 'p' assigned to register 'RW67'
dhl         p = p + 240;
dco @1a:32 u:2  mov A,#240
dco @1a:34 u:1  add A,R7
dco @1a:35 u:1  mov R7,A
dco @1a:36 u:1  clr A
dco @1a:37 u:1  addc A,R6
dco @1a:38 u:1  mov R6,A
dtx  ; variable 'p' allocated as 'auto'
dco @1a:39 u:2  mov ?i72,R6
dco @1a:3b u:2  mov ?i72+1,R7
dhl         e = p + (rcv_len - 240);
dco @1a:3d u:3  mov DPTR,#_rcv_len
dco @1a:40 u:3  lcall __ld_dptr_r67
dco @1a:43 u:2  mov A,#16
dco @1a:45 u:1  add A,R7
dco @1a:46 u:1  mov R7,A
dco @1a:47 u:2  mov A,#255
dco @1a:49 u:1  addc A,R6
dco @1a:4a u:1  mov R6,A
dco @1a:4b u:2  mov A,?i72+1
dco @1a:4d u:1  add A,R7
dco @1a:4e u:1  mov R7,A
dco @1a:4f u:2  mov A,?i72
dco @1a:51 u:1  addc A,R6
dco @1a:52 u:1  mov R6,A
dtx  ; variable 'e' allocated as 'auto'
dco @1a:53 u:2  mov ?parseDHCPMSG_e,R6
dco @1a:55 u:2  mov ?parseDHCPMSG_e+1,R7
dco @1a:57 u:3  ljmp ?60
dtx ?59:
dhl // OPTIONS auswerten
dhl         while ( p < e )
dhl         {
dco @1a:5a u:3  mov DPH,?i72
dco @1a:5d u:3  mov DPL,?i72+1
dco @1a:60 u:2  mov A,#1
dco @1a:62 u:2  add A,DPL
dco @1a:64 u:2  mov ?i72+1,A
dco @1a:66 u:1  clr A
dco @1a:67 u:2  addc A,DPH
dco @1a:69 u:2  mov ?i72,A
dco @1a:6b u:1  movx A,@DPTR
dco @1a:6c u:1  mov R5,A
dco @1a:6d u:2  xrl A,#53
dco @1a:6f u:2  jz ?67
dco @1a:71 u:2  mov R7,#53
dco @1a:73 u:1  setb C
dco @1a:74 u:1  mov A,R5
dco @1a:75 u:1  subb A,R7
dco @1a:76 u:2  jnc ?71
dco @1a:78 u:1  mov A,R5
dco @1a:79 u:2  jnz ?_21
dco @1a:7b u:3  ljmp ?63
dtx ?_21:
dco @1a:7e u:1  mov A,R5
dco @1a:7f u:2  xrl A,#1
dco @1a:81 u:2  jz ?68
dco @1a:83 u:1  mov A,R5
dco @1a:84 u:2  xrl A,#3
dco @1a:86 u:2  jnz ?_23
dco @1a:88 u:3  ljmp ?69
dtx ?_23:
dco @1a:8b u:3  ljmp ?62
dtx ?71:
dco @1a:8e u:1  mov A,R5
dco @1a:8f u:1  cpl A
dco @1a:90 u:2  jz ?65
dco @1a:92 u:3  ljmp ?62
dhl 
dhl                 switch ( *p++ ) 
dhl                 {
dtx ?65:
dhl                         case endOption :
dhl                             return      type;
dco @1a:95 u:2  mov R7,?parseDHCPMSG_type
dco @1a:97 u:3  ljmp ?56
dhl //                              goto PARSE_END;
dhl                                 break;
dtx ?67:
dhl         case padOption :
dhl //                              p++;
dhl                                 break;
dhl                 case dhcpMessageType :
dhl //                              p++;
dhl                                 p++;
dco @1a:9a u:2  mov R6,?i72
dco @1a:9c u:2  mov R7,?i72+1
dco @1a:9e u:1  inc R7
dco @1a:9f u:1  mov A,R7
dco @1a:a0 u:2  jnz ?__3
dco @1a:a2 u:1  inc R6
dtx ?__3:
dtx  ; variable 'p' assigned to register 'RW67'
dhl                                 type = *p++;
dco @1a:a3 u:2  mov DPH,R6
dco @1a:a5 u:2  mov DPL,R7
dco @1a:a7 u:2  mov A,#1
dco @1a:a9 u:2  add A,DPL
dco @1a:ab u:2  mov ?i72+1,A
dco @1a:ad u:1  clr A
dco @1a:ae u:2  addc A,DPH
dco @1a:b0 u:2  mov ?i72,A
dco @1a:b2 u:1  movx A,@DPTR
dco @1a:b3 u:1  mov R7,A
dco @1a:b4 u:2  mov ?parseDHCPMSG_type,R7
dhl                                 break;
dco @1a:b6 u:3  ljmp ?63
dtx ?68:
dtx  ; variable 'p' allocated as 'auto'
dhl                 case subnetMask :
dhl //                              p++;
dhl                                 p++;
dco @1a:b9 u:2  mov A,#1
dco @1a:bb u:2  add A,?i72+1
dco @1a:bd u:2  mov ?i74+1,A
dco @1a:bf u:1  clr A
dco @1a:c0 u:2  addc A,?i72
dco @1a:c2 u:2  mov ?i74,A
dhl                                 memcpy(subnet_ip.bytes,p,4);
dco @1a:c4 u:2  mov R2,#0
dco @1a:c6 u:2  mov R3,#4
dco @1a:c8 u:2  mov R4,#((_subnet_ip)>>8)&255
dco @1a:ca u:2  mov R5,#(_subnet_ip)&255
dco @1a:cc u:2  mov R6,?i74
dco @1a:ce u:2  mov R7,?i74+1
dco @1a:d0 u:3  lcall _xram_fast_copy
dhl                                 p+=4;
dco @1a:d3 u:2  mov A,#4
dco @1a:d5 u:2  add A,?i74+1
dco @1a:d7 u:2  mov ?i72+1,A
dco @1a:d9 u:1  clr A
dco @1a:da u:2  addc A,?i74
dco @1a:dc u:2  mov ?i72,A
dhl                                 break;
dco @1a:de u:2  sjmp ?63
dtx ?69:
dtx  ; variable 'p' allocated as 'auto'
dhl       case routersOnSubnet :
dhl //                              p++;
dhl                                 p++;
dco @1a:e0 u:2  mov A,#1
dco @1a:e2 u:2  add A,?i72+1
dco @1a:e4 u:2  mov ?i75+1,A
dco @1a:e6 u:1  clr A
dco @1a:e7 u:2  addc A,?i72
dco @1a:e9 u:2  mov ?i75,A
dhl                                 memcpy(gateway_ip.bytes,p,4);
dco @1a:eb u:2  mov R2,#0
dco @1a:ed u:2  mov R3,#4
dco @1a:ef u:2  mov R4,#((_gateway_ip)>>8)&255
dco @1a:f1 u:2  mov R5,#(_gateway_ip)&255
dco @1a:f3 u:2  mov R6,?i75
dco @1a:f5 u:2  mov R7,?i75+1
dco @1a:f7 u:3  lcall _xram_fast_copy
dhl                                 p+=4;
dco @1a:fa u:2  mov A,#4
dco @1a:fc u:2  add A,?i75+1
dco @1a:fe u:2  mov ?i72+1,A
dco @1a:100 u:1  clr A
dco @1a:101 u:2  addc A,?i75
dco @1a:103 u:2  mov ?i72,A
dhl                                 break;
dco @1a:105 u:2  sjmp ?63
dhl /*              case dns :
dhl //                              p++;
dhl                                 p++;
dhl                                 for (i = 0; i < 4; i++) DNS[i] = *p++;*/
dhl /*                              WriteScreen("dns : ");
dhl                                 inet_ntoa(DNS,IPAddrStr);
dhl                                 WriteScreen(IPAddrStr); 
dhl                                 WriteScreenf("\r\n");*/
dhl                                 break;
dtx ?62:
dhl                         default :
dhl                                 opt_len = *p++;
dco @1a:107 u:3  mov DPH,?i72
dco @1a:10a u:3  mov DPL,?i72+1
dco @1a:10d u:2  mov R6,DPH
dco @1a:10f u:2  mov R7,DPL
dco @1a:111 u:2  mov A,#1
dco @1a:113 u:1  add A,R7
dco @1a:114 u:1  mov R5,A
dco @1a:115 u:1  clr A
dco @1a:116 u:1  addc A,R6
dco @1a:117 u:1  mov R4,A
dtx  ; variable 'p' assigned to register 'RW45'
dco @1a:118 u:1  movx A,@DPTR
dco @1a:119 u:1  mov R7,A
dtx  ; variable 'opt_len' assigned to register 'R7'
dhl                                 p += opt_len;
dco @1a:11a u:2  mov R6,#0
dco @1a:11c u:1  mov A,R5
dco @1a:11d u:1  add A,R7
dco @1a:11e u:1  mov R7,A
dco @1a:11f u:1  mov A,R4
dco @1a:120 u:1  addc A,R6
dco @1a:121 u:1  mov R6,A
dco @1a:122 u:2  mov ?i72,R6
dco @1a:124 u:2  mov ?i72+1,R7
dhl                                 break;
dtx ?63:
dhl                 }
dhl         }
dtx ?60:
dtx 
dco @1a:126 u:2  mov R6,?parseDHCPMSG_e
dco @1a:128 u:2  mov R7,?parseDHCPMSG_e+1
dco @1a:12a u:2  mov R3,AR7
dco @1a:12c u:2  mov R2,AR6
dco @1a:12e u:2  mov R0,#XDS
dco @1a:130 u:2  mov R6,?i72
dco @1a:132 u:2  mov R7,?i72+1
dco @1a:134 u:2  mov R4,#XDS
dco @1a:136 u:1  clr C
dco @1a:137 u:3  lcall __cmp_u4
dco @1a:13a u:2  jnc ?_25
dco @1a:13c u:3  ljmp ?59
dtx ?_25:
dhl //PARSE_END:
dhl     return      type;
dco @1a:13f u:2  mov R7,?parseDHCPMSG_type
dtx ?56:
dco @1a:141 u:1  ret
dtx ; end of function parseDHCPMSG
dtx ; used: R01234567 BR01234567 DPTR ACC PSW B locals:7 bytes
dtx 
dtx  .import _xram_fast_copy ; void xram_fast_copy(xdata unsigned char *, xdata unsigned char *, unsigned 
dtx  .import _memset ; void memset(xdata unsigned char *, char, unsigned int)
dtx  .import _poll_net ; unsigned int poll_net(void)
dtx  .import _close_socket_udp ; unsigned int close_socket_udp(unsigned char)
dtx  .import _send_socket_udp ; unsigned int send_socket_udp(unsigned char, xdata unsigned char *, unsigne
dtx  .import _open_socket_udp ; unsigned int open_socket_udp(unsigned char, unsigned long, unsigned int)
dtx  .import _free_tx_buf ; void free_tx_buf(xdata unsigned char *)
dtx  .import _allocate_tx_buf ; xdata unsigned char *allocate_tx_buf(void)
dtx  .import _rcv_len ; xdata unsigned int rcv_len
dtx  .import _rcv_buf ; xdata unsigned char rcv_buf[1400]
dtx  .import _uc_socket ; xdata UC_SOCKET uc_socket[2]
dtx  .import _gateway_ip ; xdata IP_ADR gateway_ip
dtx  .import _subnet_ip ; xdata IP_ADR subnet_ip
dtx  .import _my_ip ; xdata IP_ADR my_ip
dtx  .import _my_mac ; xdata unsigned char my_mac[6]
dtx  .import _puts ; int puts(far char *)
dtx  .import _ET1 ; bit unsigned char ET1
dtx  .import _TMOD ; near unsigned char TMOD
dtx  .import _TH1 ; near unsigned char TH1
dtx  .import _TL1 ; near unsigned char TL1
dtx  .import _TF1 ; bit unsigned char TF1
dtx  .import _TR1 ; bit unsigned char TR1
dtx  .segment lit
dtx ?i12: ; code char [26]
dco @1b:0 u:1a  .dc.b "Error opening UDP Socket",13,0
dtx  .end
dhl }
dhl 
def:_parseDHCPMSG @1a:0
def:_send_DHCP_REQUEST @8:0
def:_SetupTimer @e:0
def:_send_DHCP_DISCOVER @5:0
def:_DHCP_SetIP @18:0
def:_DefaultNetConfig @b:0
objectend
